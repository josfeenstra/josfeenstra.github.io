(()=>{"use strict";var t={1006:(t,e,r)=>{Object.defineProperty(e,"__esModule",{value:!0});r(5652),r(4013)},2267:(t,e,r)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.Perlin=void 0;const i=r(4540);class Perlin{constructor(){this.permutation=[151,160,137,91,90,15,131,13,201,95,96,53,194,233,7,225,140,36,103,30,69,142,8,99,37,240,21,10,23,190,6,148,247,120,234,75,0,26,197,62,94,252,219,203,117,35,11,32,57,177,33,88,237,149,56,87,174,20,125,136,171,168,68,175,74,165,71,134,139,48,27,166,77,146,158,231,83,111,229,122,60,211,133,230,220,105,92,41,55,46,245,40,244,102,143,54,65,25,63,161,1,216,80,73,209,76,132,187,208,89,18,169,200,196,135,130,116,188,159,86,164,100,109,198,173,186,3,64,52,217,226,250,124,123,5,202,38,147,118,126,255,82,85,212,207,206,59,227,47,16,58,17,182,189,28,42,223,183,170,213,119,248,152,2,44,154,163,70,221,153,101,155,167,43,172,9,129,22,39,253,19,98,108,110,79,113,224,232,178,185,112,104,218,246,97,228,251,34,242,193,238,210,144,12,191,179,162,241,81,51,145,235,249,14,239,107,49,192,214,31,181,199,106,157,184,84,204,176,115,121,50,45,127,4,150,254,138,236,205,93,222,114,67,29,24,72,243,141,128,195,78,66,215,61,156,180],this.repeat=0,this.repeat=0,this.p=new Array(512);for(let t=0;t<512;t++)this.p[t]=this.permutation[t%256]}static new(){return new Perlin}grad(t,e,r,i){switch(15&t){case 0:return e+r;case 1:return-e+r;case 2:return e-r;case 3:return-e-r;case 4:return e+i;case 5:return-e+i;case 6:return e-i;case 7:return-e-i;case 8:return r+i;case 9:return-r+i;case 10:return r-i;case 11:return-r-i;case 12:return r+e;case 13:return-r+i;case 14:return r-e;case 15:return-r-i;default:return 0}}inc(t){return t++,this.repeat>0&&(t%=this.repeat),t}noise(t,e,r){this.repeat>0&&(t%=this.repeat,e%=this.repeat,r%=this.repeat);let s,o,n,a,h=255&Math.floor(t),l=255&Math.floor(e),u=255&Math.floor(r),c=t-Math.floor(t),d=e-Math.floor(e),m=r-Math.floor(r),f=this.p,g=f[f[f[h]+l]+u],p=f[f[f[h]+this.inc(l)]+u],w=f[f[f[h]+l]+this.inc(u)],x=f[f[f[h]+this.inc(l)]+this.inc(u)],v=f[f[f[this.inc(h)]+l]+u],_=f[f[f[this.inc(h)]+this.inc(l)]+u],M=f[f[f[this.inc(h)]+l]+this.inc(u)],y=f[f[f[this.inc(h)]+this.inc(l)]+this.inc(u)],b=i.GeonMath.smooth(c),V=i.GeonMath.smooth(d),R=i.GeonMath.smooth(m);return s=i.GeonMath.lerp(this.grad(g,c,d,m),this.grad(v,c-1,d,m),b),o=i.GeonMath.lerp(this.grad(p,c,d-1,m),this.grad(_,c-1,d-1,m),b),n=i.GeonMath.lerp(s,o,V),s=i.GeonMath.lerp(this.grad(w,c,d,m-1),this.grad(M,c-1,d,m-1),b),o=i.GeonMath.lerp(this.grad(x,c,d-1,m-1),this.grad(y,c-1,d-1,m-1),b),a=i.GeonMath.lerp(s,o,V),(i.GeonMath.lerp(n,a,R)+1)/2}}e.Perlin=Perlin},1138:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.App=void 0;e.App=class App{constructor(t,e=""){this.gl=t,this.name=this.constructor.name,this.description=e}ui(t){}start(){}update(t){}draw(t){}}},5134:(t,e,r)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.SwapApp=void 0;const i=r(5620),s=r(1138);class SwapApp extends s.App{constructor(t,e,r){super(t),this.currentAppIndex=-1,this.isuihidden=!1,this.core=e,this.possibleApps=r}getAppNames(){let t=[],e=this.possibleApps.length;for(let r=0;r<e;r++)t.push(this.possibleApps[r].name.replace("App",""));return t}ui(t){let e=this.getAppNames();this.param=i.EnumParameter.new("apps",0,e),t.addDropdown(this.param,(t=>{this.swap(t)}))}swapFromUrl(t,e){let r=t.substr(1),i=this.getAppNames();for(let t=0;t<i.length;t++)if(i[t].toLowerCase()===r)return void this.swap(t);console.log("no hash match, defaulting..."),this.swap(e)}swap(t){let e=this.possibleApps[t];if(this.currentAppIndex>-1){let t=this.possibleApps[this.currentAppIndex];console.log("removing",t.name),this.core.removeApp(t.name)}console.log("constructing",e.name),this.currentAppIndex=t;let r=new e(this.gl);location.hash="#"+e.name.replace("App","").toLowerCase(),this.core.addApp(r)}update(t){t.IsKeyPressed("m")&&this.core.ui.toggleVisibility()}}e.SwapApp=SwapApp},8265:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.Combo=e.Combi=void 0;e.Combi=class Combi{constructor(t,e,r){this.buffered=[],this.state=[],this.buffered,this.renderer=r(t)}buffer(){}render(t){for(let e=0;e<this.buffered.length;e++){const r=this.buffered[e];this.renderer.setAndRender(r,t)}}};e.Combo=class Combo{constructor(t,e,r){this.state=e,this.buffered,this.renderer=r(t)}buffer(){}render(t){this.renderer.render(t)}}},4109:(t,e,r)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.ImageCombi=void 0;const i=r(5739),s=r(1778),o=r(232),n=r(4013),a=r(5652),h=r(7854),l=r(8265);class ImageCombi extends l.Combi{constructor(t){super(t,[],h.TextureMeshShader.new)}static new(t){return new ImageCombi(t)}buffer(){this.buffered=[];let t=0;this.state.forEach(((e,r)=>{let h=e.height,l=e.width,u=new s.Rectangle3(i.Plane.fromPVV(new n.Vector3(0,0,0),new n.Vector3(0,0,1),new n.Vector3(-1,0,0)),o.Domain2.fromBounds(10,10+l,t,t+h)),c=a.Mesh.fromRect(u);c.setTexture(e.resize(256,256).toImageData()),this.buffered.push(c),t+=h+10}))}}e.ImageCombi=ImageCombi},9742:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.FloatMatrix=void 0;class FloatMatrix{constructor(t,e,r=[]){this.height=t,this.width=e,this.data=new Float32Array(this.width*this.height),r==[]||0==r.length||this.setData(r)}print(){let t=[];for(var e=0;e<this.width;e++){t.push("|");for(var r=0;r<this.height;r++){let i=this.get(r,e).toFixed(2);i=i.padStart(8," "),t.push(i),r<this.width-2&&t.push("  ")}t.push("  |\n")}console.log(t.join(""))}setData(t){if(t.length!=this.height*this.width)throw"data.length does not match width * height "+t.length.toString();this.data.set(t)}count(){return this.height}getDimensions(){return[this.height,this.width]}fill(t){let e=this.height*this.width;for(let r=0;r<e;r++)this.data[r]=t}fillWith(t,e=this.width){let r=e;if(r>this.width)throw"values per entry is larger than this._width. This will spill over.";for(let e=0;e<this.height;e++)for(let i=0;i<r;i++)this.set(e,i,t[e*r+i])}fillFrom(t){if(t.height<this.height||t.width<this.width)throw new Error("need same dimentions");for(let e=0;e<t.height;e++)for(let r=0;r<2;r++)this.set(e,r,t.get(e,r));return this}get(t,e){return this.data[t*this.width+e]}getRow(t){let e=new Float32Array(this.width);for(let r=0;r<this.width;r++)e[r]=this.get(t,r);return e}getColumn(t){let e=new Float32Array(this.height);for(let r=0;r<this.height;r++){let i=r*this.width+t;e[r]=this.data[i]}return e}set(t,e,r){this.data[t*this.width+e]=r}setRow(t,e){for(let r=0;r<this.width;r++)this.set(t,r,e[r])}forEachValue(t){for(let e=0;e<this.data.length;e++)this.data[e]=t(this.data[e],e);return this}takeRows(t){const e=t.length;let r=new FloatMatrix(e,this.width);for(let i=0;i<e;i++){let e=t[i];r.setRow(i,this.getRow(e))}return r}mapWith(t,e){let r=this.clone(),i=Math.min(this.width,t.height),s=Math.min(this.height,t.height);for(var o=0;o<s;o++)for(var n=0;n<i;n++)r.set(o,n,e(this.get(o,n),t.get(o,n)));return r}multiplied(t){let e=this;if(t.height!==e.width)throw new Error(`Columns in A should be the same as the number of rows in B\n                b.width ${t.height},\n                a.height ${e.width}`);for(var r=new FloatMatrix(e.height,t.width),i=0;i<r.height;i++)for(var s=0;s<t.width;s++)for(var o=0;o<e.width;o++)r.set(i,s,r.get(i,s)+e.get(i,o)*t.get(o,s));return r}multiply(t){let e=this.multiplied(t);return this.data=e.data,this}static fromNative(t){let e=t.length,r=t[0].length,i=new FloatMatrix(e,r);for(var s=0;s<t.length;s++)for(var o=0;o<t[0].length;o++)i.set(s,o,t[s][o]);return i}toNative(){let t=[];for(var e=0;e<this.height;e++){t[e]=[];for(var r=0;r<this.width;r++)t[e][r]=this.get(e,r)}return t}clone(){let t=new FloatMatrix(this.height,this.width);for(let e=0;e<this.data.length;e++)t.data[e]=this.data[e];return t}}e.FloatMatrix=FloatMatrix},8299:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.HashTable=void 0;e.HashTable=class HashTable{constructor(){this.data=new Map}stringify(t){return t.toString()}set(t,e){return this.data.set(this.stringify(t),e)}has(t){return this.data.has(this.stringify(t))}get(t){return this.data.get(this.stringify(t))}}},7810:(t,e,r)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.IntCube=void 0;const i=r(4013);class IntCube{constructor(t,e,r,i=[]){this._height=t,this._width=e,this._depth=r;let s=this._width*this._height*this._depth;this.data=new Int32Array(s),i==[]||0==i.length?this.fill(0):this.setData(i)}size(){return this._width*this._height*this._depth}clone(){let t=new IntCube(this._height,this._width,this._depth);return t.data=this.data,t}setData(t){if(t.length!=this.size())throw"data.length does not match width * height "+t.length.toString();this.data.set(t)}fill(t){let e=this.size();for(let r=0;r<e;r++)this.data[r]=t}inRange(t,e,r){return!(t<0||e<0||r<0||t>this._width-1||e>this._height-1||r>this._depth-1)}getIndex(t,e,r){return t*(this._height*this._depth)+e*this._depth+r}getCoords(t){let e=Math.floor(t/(this._height*this._depth))%this._width,r=Math.floor(t/this._depth)%this._height,s=t%this._depth;return new i.Vector3(e,r,s)}get(t,e,r){return this.data[this.getIndex(t,e,r)]}tryGet(t,e,r){return this.inRange(t,e,r)?this.data[this.getIndex(t,e,r)]:void 0}set(t,e,r,i){this.data[this.getIndex(t,e,r)]=i}trySet(t,e,r,i){this.inRange(t,e,r)&&(this.data[this.getIndex(t,e,r)]=i)}iter(t){for(let e=0;e<this.data.length;e++)t(this.data[e],e)}map(t){for(let e=0;e<this.data.length;e++)this.data[e]=t(this.data[e],e)}trueForAll(t){for(let e=0;e<this.data.length;e++)if(!t(this.data[e],e))return!1;return!0}}e.IntCube=IntCube},9593:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.IntMatrix=void 0;class IntMatrix{constructor(t,e,r=[]){this._height=t,this._width=e,this.data=new Uint16Array(this._width*this._height),r==[]||0==r.length?this.fill(0):this.setData(r)}static fromList(t,e){let r=t.length/e,i=new IntMatrix(r,e);for(let e=0;e<t.length;e++)i.data[e]=t[e];return i}print(){let t=[];for(var e=0;e<this._height;e++){t.push("|");for(var r=0;r<this._width;r++){let i=this.get(e,r).toFixed(2);i=i.padStart(8," "),t.push(i),r<this._width-2&&t.push("  ")}t.push("  |\n")}console.log(t.join(""))}clone(){let t=new IntMatrix(this._height,this._width);return t.data=this.data,t}setData(t){if(t.length!=this._height*this._width)throw"data.length does not match width * height "+t.length.toString();this.data.set(t)}count(){return this._height}getDimensions(){return[this._height,this._width]}inRange(t,e){return!(t<0||t>this._height-1||e<0||e>this._width-1)}fill(t){let e=this._height*this._width;for(let r=0;r<e;r++)this.data[r]=t}fillWith(t,e=this._width){let r=e;if(r>this._width)throw"values per entry is larger than this._width. This will spill over.";for(let e=0;e<this._height;e++)for(let i=0;i<r;i++)this.set(e,i,t[e*r+i])}get(t,e){return this.inRange(t,e)?this.data[t*this._width+e]:(console.warn("out of range!"),0)}getRow(t){let e=new Uint16Array(this._width);for(let r=0;r<this._width;r++)e[r]=this.get(t,r);return e}getColumn(t){let e=new Uint16Array(this._height);for(let r=0;r<this._height;r++){let i=r*this._width+t;e[r]=this.data[i]}return e}set(t,e,r){this.inRange(t,e)?this.data[t*this._width+e]=r:console.warn("out of range!")}setRow(t,e){for(let r=0;r<this._width;r++)this.set(t,r,e[r])}takeRows(t){console.log(this._height,this._width);const e=t.length;let r=new IntMatrix(e,this._width);for(let i=0;i<e;i++){let e=t[i];r.setRow(i,this.getRow(e))}return r}getData(){return this.data}forEachValue(t){for(let e=0;e<this.data.length;e++)this.data[e]=t(this.data[e],e);return this}forEachRow(t){for(let e=0;e<this._height;e++){let r=this.getRow(e);t(r,e),this.setRow(e,r)}return this}trueForAll(t){for(let e=0;e<this.data.length;e++)if(!t(this.data[e],e))return!1;return!0}}e.IntMatrix=IntMatrix},8837:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.LinkedList=void 0;e.LinkedList=class LinkedList{constructor(){this.head=null}empty(){return!this.head}last(){for(var t=this.head;t.getNext();)t=t.getNext();return t}find(t){for(var e=this.head;e;){if(e.getKey()==t)return e.value();e=e.getNext()}return!1}insert(t,e){var r=new ListNode(t,e);this.head?this.last().next(r):this.head=r}print(){for(var t=this.head;t;)console.log(t.value()+" "),t=t.getNext()}};class ListNode{constructor(t,e){this.nextNode=null,this.key=e,this.val=t}getNext(){return this.nextNode}next(t){this.nextNode=t}getKey(){return this.key}value(){return this.val}}},9782:(t,e,r)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.MultiVector2=void 0;const i=r(5817),s=r(4013),o=r(9742),n=r(3986);class MultiVector2 extends i.Geo{constructor(t){super(),this.matrix=t}static new(t){return new MultiVector2(new o.FloatMatrix(t,2))}static fromList(t){let e=t.length,r=MultiVector2.new(e);for(let e=0;e<t.length;e++)r.matrix.set(e,0,t[e].x),r.matrix.set(e,1,t[e].y);return r}static fromMatrix(t){if(2!=t.width)throw new Error("incorrect.");return new MultiVector2(t)}static fromData(t){let e=MultiVector2.new(t.length/2);return e.matrix.fillWith(t),e}get width(){return this.matrix.width}get height(){return this.matrix.height}get dimensions(){return this.matrix.width}get count(){return this.matrix.height}forEach(t){for(let e=0;e<this.count;e++){let r=this.get(e);t(r,e),this.set(e,r)}return this}map(t){let e=this.clone();for(let r=0;r<this.count;r++){let i=this.get(r),o=t(i,r);o instanceof s.Vector2?e.set(r,o):e.set(r,i)}return e}set(t,e){this.matrix.data[t*this.matrix.width+0]=e.x,this.matrix.data[t*this.matrix.width+1]=e.y}setXY(t,e,r){this.matrix.data[t*this.matrix.width+0]=e,this.matrix.data[t*this.matrix.width+1]=r}get(t){return new s.Vector2(this.matrix.data[t*this.width+0],this.matrix.data[t*this.width+1])}toMatrixSlice(){return this.matrix}toList(){let t=[];for(let e=0;e<this.height;e++)t.push(this.get(e));return t}to3D(){let t=n.MultiVector3.new(this.count);for(let e=0;e<this.count;e++){let r=this.matrix.getRow(e);t.setXYZ(e,r[0],r[1],0)}return t}clone(){let t=MultiVector2.new(this.count);return t.matrix=this.matrix.clone(),t}transform(t){return this.matrix.multiply(t),this}transformed(t){let e=MultiVector2.new(this.count);return e.matrix=this.matrix.multiplied(t),e}}e.MultiVector2=MultiVector2},3986:(t,e,r)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.MultiVector3=void 0;const i=r(5817),s=r(9907),o=(r(7921),r(4013)),n=(r(8663),r(9742)),a=r(9782);class MultiVector3 extends i.Geo{constructor(t){super(),this.matrix=t}static new(t){return new MultiVector3(new n.FloatMatrix(t,3))}static fromList(t){let e=t.length,r=MultiVector3.new(e);return r.fillFromList(t),r}static fromNative(t){return new MultiVector3(n.FloatMatrix.fromNative(t))}static fromData(t){let e=MultiVector3.new(t.length/2);return e.matrix.fillWith(t),e}static fromMatrix(t){if(3!=t.width)throw new Error("incorrect.");return new MultiVector3(t)}get width(){return this.matrix.width}get height(){return this.matrix.height}get dimensions(){return this.matrix.width}get count(){return this.matrix.height}setXYZ(t,e,r,i){this.matrix.data[t*this.width+0]=e,this.matrix.data[t*this.width+1]=r,this.matrix.data[t*this.width+2]=i}set(t,e){this.matrix.data[t*this.width+0]=e.x,this.matrix.data[t*this.width+1]=e.y,this.matrix.data[t*this.width+2]=e.z}get(t){return new o.Vector3(this.matrix.data[t*this.width+0],this.matrix.data[t*this.width+1],this.matrix.data[t*this.width+2])}slice(){return this.matrix}fillFromList(t){for(let e=0;e<t.length;e++)this.set(e,t[e])}forEach(t){for(let e=0;e<this.count;e++){let r=this.get(e);r=t(r,e),r instanceof o.Vector3&&this.set(e,r)}return this}take(t){const e=t.length;let r=MultiVector3.new(e);for(let i=0;i<e;i++){let e=t[i];r.set(i,this.get(e))}return r}takeRange(t,e){let r=MultiVector3.new(e-t),i=0;for(let s=t;s<e;s++)r.set(i,this.get(s)),i++;return r}map(t){let e=this.clone();for(let r=0;r<this.count;r++){let i=this.get(r),s=t(i,r);s instanceof o.Vector3?e.set(r,s):e.set(r,i)}return e}mapWith(t,e){let r=this.matrix.mapWith(t.matrix,e);return new MultiVector3(r)}toList(){let t=[];for(let e=0;e<this.height;e++)t.push(this.get(e));return t}to2D(){return a.MultiVector2.fromMatrix(this.matrix)}mean(){let t=o.Vector3.zero(),e=this.count;for(let r=0;r<e;r++)t.x+=this.matrix.data[3*r],t.y+=this.matrix.data[3*r+1],t.z+=this.matrix.data[3*r+2];return t.scale(1/e)}average(){return this.mean()}closestId(t){let e=1/0,r=-1;return this.forEach(((i,s)=>{let o=t.disToSquared(i);o<e&&(e=o,r=s)})),r}closestIds(t,e){let r=[];for(let i=0;i<e;i++){let e=1/0,i=-1;this.forEach(((s,o)=>{if(r.includes(i))return;let n=t.disToSquared(s);n<e&&(e=n,i=o)})),r.push(i)}return r}clone(){return new MultiVector3(this.matrix.clone())}transform(t){for(let e=0;e<this.height;e++){let r=this.get(e);r=t.multiplyVector(r),this.set(e,r)}return this}move(t){for(let e=0;e<this.height;e++){let r=this.get(e);r.add(t),this.set(e,r)}return this}scale(t){for(let e=0;e<this.height;e++){let r=this.get(e);r.mul(t),this.set(e,r)}return this}transformed(t){return new MultiVector3(function calc(t,e){let r=new n.FloatMatrix(t.height,e.width);for(var i=0;i<t.height;i++)for(var s=0;s<4;s++){for(var o=0;o<3;o++)r.set(i,s,r.get(i,s)+t.get(i,o)*e.get(o,s));r.set(i,s,r.get(i,s)+1*e.get(3,s))}return r}(this.matrix,t))}moved(t){let e=s.Matrix4.newTranslate(t);return this.transformed(e)}scaled(t){let e=s.Matrix4.newScaler(t.x,t.y,t.z);return this.transformed(e)}}e.MultiVector3=MultiVector3},3173:(t,e,r)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.ToFloatMatrix=void 0;const i=r(4735);e.ToFloatMatrix=function ToFloatMatrix(t){return t instanceof i.FloatMatrix?t:t instanceof i.MultiVector2?t.toMatrixSlice():t instanceof i.MultiVector3?t.slice():t[0]instanceof i.Vector2?i.MultiVector2.fromList(t).toMatrixSlice():i.MultiVector3.fromList(t).slice()}},5886:(t,e,r)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.Circle2=void 0;const i=r(6583),s=r(4013);e.Circle2=class Circle2{constructor(t,e){this.center=t,this.radius=e}static centersFromPPR(t,e,r){let o=e.clone().sub(t),n=o.length(),a=t.clone().add(e).scale(.5),h=r**2-(n/2)**2;if(h<-i.Const.TOLERANCE)return[];if(h<i.Const.TOLERANCE)return[a];{let t=h**.5,e=new s.Vector2(o.y,-o.x).normalize();return[a.clone().add(e.clone().scale(t)),a.clone().add(e.clone().scale(-t))]}}}},8773:(t,e,r)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.Circle3=void 0;const i=r(6583),s=r(6652),o=r(5739);class Circle3{constructor(t,e){this.plane=t,this.radius=e}static new(t,e){return new Circle3(t,e)}static newPlanar(t,e){return new Circle3(o.Plane.WorldXY().moveTo(t),e)}static fromCircle2(t,e=o.Plane.WorldXY()){let r=e.pushToWorld(t.center.to3D());return(e=e.clone()).center=r,new Circle3(e,t.radius)}buffer(){return s.MultiLine.fromCircle(this)}includes(t){let[e,r]=this.plane.closestPoint(t);return r/=3,r**2+(this.plane.center.clone().disTo(e)-this.radius)**2<i.Const.TOL_SQUARED}}e.Circle3=Circle3},2504:(t,e,r)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.Cube=void 0;const i=r(4735);class Cube{constructor(t,e){this.plane=t,this.domain=e}static new(t,e){return new Cube(t,e)}static fromRadius(t,e){return new Cube(i.Plane.WorldXY().moveTo(t),i.Domain3.fromRadius(e))}getCorners(){return this.domain.corners(this.plane.matrix)}}e.Cube=Cube},7063:(t,e,r)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.Cubez=e.Bezier=void 0;const i=r(3986),s=r(4735),o=r(6583),n=r(3880),a=(r(7921),r(6820)),h=r(4013),l=(r(8663),r(3324));class Bezier extends l.Curve{constructor(t,e){super(t,e)}static fromList(t){return this.new(i.MultiVector3.fromList(t))}static new(t){return new Bezier(t,t.count-1)}static equalizeDegrees(t){let e=0;for(let r of t)r.degree>e&&(e=r.degree);for(let r=0;r<t.length;r++){let i=0;for(;t[r].degree<e&&i<100;)t[r]=t[r].increaseDegree(),i++}return t}hodograph(){let t=i.MultiVector3.new(this.verts.count-1);for(let e=0;e<this.verts.count-1;e++)t.set(e,this.verts.get(e+1).subbed(this.verts.get(e)));return Bezier.new(t)}increaseDegree(){let t=this.degree,e=i.MultiVector3.new(t+2);e.set(0,this.verts.get(0)),e.set(e.count-1,this.verts.get(this.verts.count-1));for(let r=1;r<t+1;r++){let i=this.verts.get(r-1),s=this.verts.get(r),o=r/(t+1),n=1-o,a=i.scale(o).add(s.scale(n));e.set(r,a)}return Bezier.new(e)}splitAt(t){let e=this.degree+1,r=n.Polynomial.decastejau(this.verts,t),i=a.Util.getTriangleLeft(r,e),s=a.Util.getTriangleRight(r,e);return[Bezier.new(i),Bezier.new(s)]}extend(t){let e=n.Polynomial.decastejauExtrapolateEnd(this.verts,t),r=this.verts.count,i=a.Util.getTriangleBase(e,r);this.verts=i}getExtention(t){let e=n.Polynomial.decastejauExtrapolateEnd(this.verts,t),r=this.verts.count,i=a.Util.getTriangleRight(e,r);return Bezier.new(i)}pointAt(t){let e=h.Vector3.zero();for(let r=0;r<this.degree+1;r++)e.add(this.verts.get(r).scaled(n.Polynomial.bernstein(t,r,this.degree)));return e}tangentAt(t){return this.hodograph().pointAt(t).normalize()}normalAt(t,e=h.Vector3.unitZ()){return this.tangentAt(t).cross(e)}ApproxClosestPoint(t,e=5,r=o.Const.TOLERANCE){let disToParam=e=>t.disToSquared(this.pointAt(e)),i=e*this.verts.count,n=1/0,h=-1;for(let t=1;t<i+1;t++){let e=disToParam(t/i);e<n&&(n=e,h=t)}let l=Math.max((h-1)/i,0),u=Math.min((h+1)/i,1),c=s.Domain.new(l,u);return a.Util.lowestScore(c,disToParam,r)}uglyClosestPoint(t,e=4){let r=[],i=[],addSuspect=t=>{r.push(this.pointAt(t)),i.push(t)};addSuspect(this.domain.t0),addSuspect(this.domain.t1);let s=1/0,o=-1;for(let e=0;e<r.length;e++){let i=t.disToSquared(r[e]);i<s&&(s=i,o=e)}return[r[o],i[o]]}pointAtApproxLength(t){this.toPolyline(100).tAtLength(t)}getLazyApprox(){return this._approx||this.bufferApprox(),this._approx}bufferApprox(){this._approx=this.toPolyline(100)}clone(){return Bezier.new(this.verts.clone())}transform(t){return this._approx=void 0,this.verts.transform(t),this}transformed(t){return this._approx=void 0,Bezier.new(this.verts.transformed(t))}}e.Bezier=Bezier;class Cubez extends Bezier{constructor(t){super(t,3)}static new(t){return new Cubez(t)}}e.Cubez=Cubez},3324:(t,e,r)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.Curve=void 0;const i=r(3986),s=r(4735),o=r(232),n=r(6583),a=r(6652),h=r(5817);class Curve extends h.Geo{constructor(t,e,r=o.Domain.new(0,1)){super(),this.verts=t,this.degree=e,this.domain=r}toPolyline(t){let e=t+1,r=i.MultiVector3.new(e);for(let i=0;i<e;i++){let e=i/t;r.set(i,this.pointAt(this.domain.elevate(e)))}return s.Polyline.new(r)}buffer(t=n.Const.BEZIER_SEGMENTS){return a.MultiLine.fromPolyline(this.toPolyline(t))}}e.Curve=Curve},1220:(t,e,r)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.Polyline=void 0;const i=r(4735),s=r(3324);class Polyline extends s.Curve{constructor(t){super(t,1),this.bufferLengths()}static fromList(t){return this.new(i.MultiVector3.fromList(t))}static new(t){return new Polyline(t)}fillet(t){let e=this.verts.count+(this.verts.count-2),r=i.MultiVector3.new(e);for(let t=0;t<e;t++){let e=Math.ceil(t/2);r.set(t,this.verts.get(e))}return Polyline.new(r)}pointAt(t){let e=t*(this.verts.count-1),r=Math.floor(e),s=Math.ceil(e);return i.Vector3.fromLerp(this.verts.get(r),this.verts.get(s),e-r)}lengthAt(t){let e=this.getLazyLengths();return i.GeonMath.sample(e,t)}tAtLength(t){let e=this.getLazyLengths(),[r,s]=i.GeonMath.between(e,t),[o,n]=[e[r],e[s]],a=i.GeonMath.fraction(t,o,n);return i.GeonMath.lerp(e[r],e[s],a)}length(){return this.getLazyLengths()[this.verts.count-1]}getLazyLengths(){return this._lengths||this.bufferLengths(),this._lengths}bufferLengths(){let t=this.verts.count,e=Array(t),r=0;e[0]=r;for(let i=0;i<t-1;i++)r+=this.verts.get(i).disTo(this.verts.get(i+1)),e[i+1]=r;this._lengths=e}buffer(){return i.MultiLine.fromPolyline(this)}clone(){return Polyline.new(this.verts.clone())}transform(t){return this._lengths=void 0,this.verts.transform(t),this}transformed(t){return this._lengths=void 0,Polyline.new(this.verts.transformed(t))}}e.Polyline=Polyline},2871:(t,e,r)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.Spline=void 0;const i=r(3986),s=r(232),o=r(3880),n=r(4013),a=r(7063),h=r(3324);class Spline extends h.Curve{constructor(t,e,r,i){super(t,e,i),this.knots=r}static fromList(t,e){return this.new(i.MultiVector3.fromList(t),e)}static calcKnots(t,e){let r=new Float32Array(t+e+1);for(let t=0;t<e+1;t++)r[t]=0-1e-4*(e-t);let i=r.length-e-e-1,s=1;for(let t=e+1;t<r.length-e-1;t++)r[t]=s/i,s++;s=0;for(let t=r.length-e-1;t<r.length;t++)r[t]=1+1e-4*s,s++;return r}static new(t,e){let r=s.Domain.new(0,1),i=t.count;if(i<e+1)return;let o=this.calcKnots(i,e);return new Spline(t,e,o,r)}extend(t){let e=this.degree+1,r=new Array(e);for(let t=0;t<e;t++){let i=this.verts.count-e+t;r[t]=this.verts.get(i)}let i=a.Bezier.fromList(r);i.extend(t);for(let t=0;t<e;t++){let r=this.verts.count-e+t;this.verts.set(r,i.verts.get(t))}return this}getExtention(t){let e=this.degree+1,r=new Array(e);for(let t=0;t<e;t++)r[t]=this.verts.get(this.verts.count-e+t);return a.Bezier.fromList(r).getExtention(t)}pointAt(t){let e=n.Vector3.zero();for(let r=0;r<this.verts.count;r++){let i=o.Polynomial.coxdeboor(t,r,this.degree,this.knots);e.add(this.verts.get(r).scaled(i))}return e}clone(){throw new Error("Method not implemented.")}transform(t){throw new Error("Method not implemented.")}transformed(t){throw new Error("Method not implemented.")}}e.Spline=Spline},5817:(t,e,r)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.Geo=void 0;const i=r(9907);e.Geo=class Geo{rotateX(t){let e=i.Matrix4.newXRotation(t);return this.transform(e)}rotateY(t){let e=i.Matrix4.newYRotation(t);return this.transform(e)}rotateZ(t){let e=i.Matrix4.newZRotation(t);return this.transform(e)}rotate(t,e){let r=i.Matrix4.newAxisRotation(e,t);return this.transform(r)}move(t){let e=i.Matrix4.newTranslate(t);return this.transform(e)}scale(t){let e=i.Matrix4.newScaler(t.x,t.y,t.z);return this.transform(e)}rotatedX(t){let e=i.Matrix4.newXRotation(t);return this.transformed(e)}rotatedY(t){let e=i.Matrix4.newYRotation(t);return this.transformed(e)}rotatedZ(t){let e=i.Matrix4.newZRotation(t);return this.transformed(e)}rotated(t,e){let r=i.Matrix4.newAxisRotation(e,t);return this.transformed(r)}moved(t){let e=i.Matrix4.newTranslate(t);return this.transformed(e)}scaled(t){let e=i.Matrix4.newScaler(t.x,t.y,t.z);return this.transformed(e)}}},1822:(t,e,r)=>{Object.defineProperty(e,"__esModule",{value:!0});r(4735)},7596:(t,e,r)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.LineCurve2=void 0;const i=r(232),s=r(4013);e.LineCurve2=class LineCurve2{constructor(t,e){this.from=t,this.to=e,this.vector=e.subbed(this.from),this.normal=this.vector.normalized(),this.bounds=new i.Domain(0,this.vector.length()),this.length=this.vector.length()}at(t,e=!0){return e&&(t=this.bounds.comform(t)),s.Vector2.fromLerp(this.from,this.to,t/this.length)}atNormal(t,e=!0){return e&&(t=new i.Domain(0,1).comform(t)),s.Vector2.fromLerp(this.from,this.to,t)}closestPoint(t,e=!0){if(0===this.vector.length())return;let r=t.subbed(this.from).dot(this.vector);return this.at(r,e)}}},5739:(t,e,r)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.Plane=void 0;const i=r(4735);class Plane{constructor(t){this._matrix=t}static fromPN(t,e){let r=e.cross(i.Vector3.unitX());r.length()<i.Const.TOLERANCE&&(r=e.cross(i.Vector3.unitY()));let s=r.normalize(),o=e.cross(s).normalize(),n=Plane.planeMatrixFromVecs(t,s,o,e);return new Plane(n)}static fromPVV(t,e,r){let i=e.clone().cross(r).normalize(),s=t.clone(),o=e.normalize(),n=e.clone().cross(i),a=Plane.planeMatrixFromVecs(s,o,n,i);return new Plane(a)}static from3pt(t,e,r){let i=e.clone().sub(t),s=r.clone().sub(t);return this.fromPVV(t,i,s)}static WorldXY(){return Plane.from3pt(i.Vector3.zero(),i.Vector3.unitX(),i.Vector3.unitY())}static WorldYZ(){return Plane.from3pt(i.Vector3.zero(),i.Vector3.unitY(),i.Vector3.unitZ())}static WorldXZ(){return Plane.from3pt(i.Vector3.zero(),i.Vector3.unitX(),i.Vector3.unitZ())}static fromLeastSquares(t){let e=t.mean(),r=i.Stat.cov(t.slice()),[s,o]=i.Stat.eig(r);console.log(s);let n=i.Vector3.fromArray(o.getColumn(0)),a=i.Vector3.fromArray(o.getColumn(1));return Plane.fromPVV(e,n,a)}static fromXYLeastSquares(t){let e=t.mean();return Plane.WorldXY().transform(i.Matrix4.newTranslation(e.x,e.y,e.z))}static planeMatrixFromVecs(t,e,r,s){return new i.Matrix4([e.x,e.y,e.z,0,r.x,r.y,r.z,0,s.x,s.y,s.z,0,t.x,t.y,t.z,1])}get ihat(){return i.Vector3.fromArray(this._matrix.getRow(0))}get jhat(){return i.Vector3.fromArray(this._matrix.getRow(1))}get khat(){return i.Vector3.fromArray(this._matrix.getRow(2))}get center(){return i.Vector3.fromArray(this._matrix.getRow(3))}get matrix(){return this._matrix.clone()}get normal(){return this.khat}get d(){return this.closestPoint(i.Vector3.zero())[1]}set ihat(t){this._matrix.setRow(0,[t.x,t.y,t.z,0])}set jhat(t){this._matrix.setRow(1,[t.x,t.y,t.z,0])}set khat(t){this._matrix.setRow(2,[t.x,t.y,t.z,0])}set center(t){this._matrix.setRow(3,[t.x,t.y,t.z,1])}set matrix(t){this._matrix=t}get inverse(){return this._matrix.inverse()}setPosition(t){this.center=t}setNormal(t){this.khat=t}clone(){return new Plane(this._matrix.clone())}transform(t){return this._matrix=this._matrix.multiply(t),this}moveTo(t){return this.center=t,this}pullToPlane(t){return this.inverse.multiplyVector(t)}pushToWorld(t){return this.matrix.multiplyVector(t)}closestPoint(t){let e=this.pullToPlane(t),r=e.z;return e.z=0,[this.pushToWorld(e),r]}rotateVector(t,e){let r=this.pullToPlane(t);return r=i.Matrix4.newAxisRotation(this.normal,e).multiplyVector(r),this.pushToWorld(r)}}e.Plane=Plane},1778:(t,e,r)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.Rectangle3=e.Rectangle2=void 0;const i=r(232),s=r(9907),o=r(4013),n=r(5739);e.Rectangle2=class Rectangle2{constructor(t,e){this.pose=t,this.domain=e}static new(t,e,r,o){s.Matrix3.newTranslation(t,e),i.Domain2.fromBounds(0,0,r,o)}center(){return this.pose.transformVector(new o.Vector2(0,0))}getVertices(){let t=[new o.Vector2(this.domain.x.t0,this.domain.y.t0),new o.Vector2(this.domain.x.t1,this.domain.y.t0),new o.Vector2(this.domain.x.t0,this.domain.y.t1),new o.Vector2(this.domain.x.t1,this.domain.y.t1)];return t.forEach((t=>this.pose.transformVector(t))),t}to3D(){let t=this.pose.toMat4();return new Rectangle3(new n.Plane(t),this.domain)}};class Rectangle3{constructor(t,e){this.plane=t,this.domain=e}static new(t,e){return new Rectangle3(t,e)}getCorners(){return this.domain.corners().map((t=>this.plane.pushToWorld(t.to3D())))}}e.Rectangle3=Rectangle3},8093:(t,e,r)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.BezierSquare=void 0;const i=r(3986),s=r(4735),o=r(232),n=r(3880),a=r(7921),h=r(4013),l=r(8663),u=r(7063),c=r(9735);class BezierSquare extends c.BiSurface{constructor(t,e,r){super(),this.verts=t,this.degreeU=e,this.degreeV=r}static new(t,e,r){if(t.count==(e+1)*(r+1))return new BezierSquare(t,e,r);console.warn(`BiSurface Not Created. ${t.count} vertices \n                does not match ${e} degreeU times ${r} degreeV surface...`)}static fromFourEdge(t,e,r,i){}static fromLoft(t){let e=(t=u.Bezier.equalizeDegrees(t))[0].degree,r=t.length-1,s=e+1*t.length,o=i.MultiVector3.new(s),n=0;for(let e=0;e<t.length;e++)for(let r=0;r<t[e].verts.count;r++)o.set(n,t[e].verts.get(r)),n++;return BezierSquare.new(o,r,e)}pointAt(t,e){let r=h.Vector3.zero();for(let i=0;i<this.degreeU+1;i++)for(let s=0;s<this.degreeV+1;s++){let o=n.Polynomial.bernstein(t,i,this.degreeU)*n.Polynomial.bernstein(e,s,this.degreeV),a=i*(this.degreeV+1)+s;r.add(this.verts.get(a).scaled(o))}return r}pointAtUV(t){return this.pointAt(t.x,t.y)}approxClosestPoint(t,e=2,r=s.Const.TOLERANCE){let disToParams=(e,r)=>t.disToSquared(this.pointAt(e,r)),i=e*(this.degreeU+1),n=e*(this.degreeV+1),a=1/0,h=-1,l=-1;for(let t=1;t<i+1;t++){let e=t/i;for(let r=1;r<i+1;r++){let i=disToParams(e,r/n);i<a&&(a=i,h=t,l=r)}}let u=o.Domain2.fromBounds(Math.max((h-1)/i,0),Math.min((h+1)/i,1),Math.max((l-1)/n,0),Math.min((l+1)/n,1));return s.Util.lowestScoreSquared(u,disToParams,r)}clone(){return BezierSquare.new(this.verts.clone(),this.degreeU,this.degreeV)}transform(t){return this._approx=void 0,this.verts.transform(t),this}transformed(t){return this._approx=void 0,BezierSquare.new(this.verts.transformed(t),this.degreeU,this.degreeV)}}e.BezierSquare=BezierSquare,function test(t=1e3){let e=l.Stopwatch.new(),r=a.Random.fromSeed(1234),i=o.Domain2.fromRadius(-11).offset([-22,22,0,0]).spawn(3,3).to3D().forEach((t=>t.add(h.Vector3.fromRandomUnit(r).scale(5)).add(h.Vector3.unitZ().scale(5)))),s=BezierSquare.new(i,2,2),n=o.Domain2.fromRadii(11,11);e.log("creation");for(let e=0;e<t;e++){let t=n.elevate(h.Vector2.fromRandom(r)).to3D();s.approxClosestPoint(t)}e.log(`created ${t} closest points`)}()},4085:(t,e,r)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.Loft=void 0;const i=r(3986),s=r(5652),o=r(7063),n=r(1220),a=r(9735);class Loft extends a.BiSurface{constructor(t){super(),this.curves=t}static new(t){return new Loft(o.Bezier.equalizeDegrees(t))}getTransposedCurves(){let t=[],e=this.curves[0].verts.count,r=this.curves.length;for(let s=0;s<e;s++){let e=i.MultiVector3.new(this.curves.length);for(let t=0;t<r;t++)e.set(t,this.curves[t].verts.get(s));t.push(o.Bezier.new(e))}return t}pointAt(t,e){return this.isoCurveV(t).pointAt(e)}isoCurveV(t){return Loft.isoCurve(this.curves,t)}isoCurveU(t){let e=this.getTransposedCurves();return Loft.isoCurve(e,t)}static isoCurve(t,e){let r=i.MultiVector3.new(t.length);for(let i=0;i<t.length;i++)r.set(i,t[i].pointAt(e));return o.Bezier.new(r)}bufferExact(){let t=[];for(let e of this.curves)e instanceof n.Polyline&&t.push(e.verts.count-1);let e=t.reduce(((t,e)=>t*e));return s.Mesh.fromBiSurface(this,e,e)}clone(){let t=new Array;for(let e=0;e<this.curves.length;e++)t[e]=this.curves[e].clone();return Loft.new(t)}transform(t){for(let e of this.curves)e.transform(t);return this}transformed(t){let e=new Array;for(let r=0;r<this.curves.length;r++)e[r]=this.curves[r].transformed(t);return Loft.new(e)}}e.Loft=Loft},9735:(t,e,r)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.TriSurface=e.BiSurface=e.Surface=void 0;const i=r(4735);class Surface extends i.Geo{}e.Surface=Surface;e.BiSurface=class BiSurface extends Surface{buffer(t=100,e=100){return i.Mesh.fromBiSurface(this,t,e)}};e.TriSurface=class TriSurface extends Surface{buffer(t){return i.Mesh.fromTriSurface(this,t)}}},3441:(t,e,r)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.Triangle3=e.Triangle2=void 0;const i=r(4735);class Triangle2{constructor(t,e,r){this.a=t,this.b=e,this.c=r}points(){return i.MultiVector2.fromList([this.a,this.b,this.c])}toBarycentric(t){let e=this.b.subbed(this.a),r=this.c.subbed(this.a),s=t.subbed(this.a),o=e.dot(e),n=e.dot(r),a=r.dot(r),h=s.dot(e),l=s.dot(r),u=o*a-n*n,c=(a*h-n*l)/u,d=(o*l-n*h)/u,m=1-c-d;return new i.Vector3(m,c,d)}fromBarycentric(t){let e=this.a.scaled(t.x),r=this.b.scaled(t.y),i=this.c.scaled(t.z);return e.add(r).add(i)}closestPoint(t){let e=t.sign(this.a,this.b),r=t.sign(this.b,this.c),s=t.sign(this.c,this.a);if(e<0&&r<0&&s<0||e>0&&r>0&&s>0)return console.log("fully inside!"),t;{let o=Math.abs(e),n=Math.abs(r),a=Math.abs(s);return o<n&&o<a?new i.LineCurve2(this.a,this.b).closestPoint(t):n<a?new i.LineCurve2(this.b,this.c).closestPoint(t):new i.LineCurve2(this.c,this.a).closestPoint(t)}}}e.Triangle2=Triangle2;e.Triangle3=class Triangle3{constructor(t,e,r){this.a=t,this.b=e,this.c=r}points(){return[this.a,this.b,this.c]}getPlane(){return i.Plane.from3pt(this.a,this.b,this.c)}to2D(t=i.Plane.WorldXY()){return new Triangle2(t.pullToPlane(this.a).to2D(),t.pullToPlane(this.b).to2D(),t.pullToPlane(this.c).to2D())}closestPoint(t){let e=this.getPlane(),[r,i]=e.closestPoint(t);e.pullToPlane(r),this.to2D(e);return t}toBarycentric(t){let e=this.b.subbed(this.a),r=this.c.subbed(this.a),s=t.subbed(this.a),o=e.dot(e),n=e.dot(r),a=r.dot(r),h=s.dot(e),l=s.dot(r),u=o*a-n*n,c=(a*h-n*l)/u,d=(o*l-n*h)/u,m=1-c-d;return new i.Vector3(m,c,d)}fromBarycentric(t){let e=this.a.clone().scale(t.x),r=this.b.clone().scale(t.y),i=this.c.clone().scale(t.z);return e.added(r).add(i)}}},5622:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.GeonImage=void 0;class GeonImage{constructor(t,e,r=4){this.width=t,this.height=e,this.pixelSize=r,this.data=new Uint8ClampedArray(this.width*this.height*this.pixelSize),this.data.fill(0)}static fromImageData(t){let e=new GeonImage(t.width,t.height);return e.setData(t.data),e}toImageData(){if(4!=this.pixelSize)throw"pixelsize must be 4 for toImageData to work";return new ImageData(this.data,this.width,this.height)}setData(t){if(t.length!=this.height*this.width*this.pixelSize)throw"data.length does not match width * height ";this.data=t}clone(){let t=new GeonImage(this.width,this.height,this.pixelSize);return t.setData(this.data),t}fill(t){for(let e=0;e<this.height;e++)for(let r=0;r<this.width;r++)this.set(r,e,t);return this}fillEvery(t){for(let e=0;e<this.height;e++)for(let r=0;r<this.width;r++)this.set(r,e,t());return this}includes(t,e){return t<this.width&&t>=0&&e<this.height&&e>=0}set(t,e,r){this.data[4*(e*this.width+t)]=r[0],this.data[4*(e*this.width+t)+1]=r[1],this.data[4*(e*this.width+t)+2]=r[2],this.data[4*(e*this.width+t)+3]=r[3]}get(t,e){return[this.data[4*(e*this.width+t)],this.data[4*(e*this.width+t)+1],this.data[4*(e*this.width+t)+2],this.data[4*(e*this.width+t)+3]]}flipHor(){let t=new GeonImage(this.width,this.height,this.pixelSize);for(let e=0;e<this.height;e++)for(let r=0;r<this.width;r++){let i=this.width-1-r;t.set(r,e,this.get(i,e))}return t}flipVer(){let t=new GeonImage(this.width,this.height,this.pixelSize);for(let e=0;e<this.height;e++){let r=this.height-1-e;for(let i=0;i<this.width;i++)t.set(i,e,this.get(i,r))}return t}applyKernel(t){let e=t.count()/2-.5,r=new GeonImage(this.width-2*e,this.height-2*e,this.pixelSize);for(let i=e;i<this.width-e;i++)for(let s=e;s<this.height-e;s++){let o=this.getWithKernel(i,s,t,e);r.set(i-e,s-e,o)}return r}getMinMax(){let t=1/0,e=0;for(let r=0;r<this.data.length;r++)this.data[r]<t?t=this.data[r]:this.data[r]>e&&(e=this.data[r]);return[t,e]}applyThreshold(t,e){return this.apply(((r,i)=>{let s=this.get(r,i);return s[0]<t?[0,0,0,0]:s[0]>e?[255,255,255,255]:s}))}apply(t){let e=new GeonImage(this.width,this.height,this.pixelSize);for(let r=0;r<this.height;r++)for(let i=0;i<this.width;i++)e.set(i,r,t(i,r));return e}applyNMS(){let t=new GeonImage(this.width-2,this.height-2,this.pixelSize);for(let t=1;t<this.width-1;t++)for(let t=1;t<this.height-1;t++);return t}getWithKernel(t,e,r,i){let s=[0,0,0,255],[o,n]=r.getDimensions();for(let a=0;a<o;a++)for(let o=0;o<n;o++){let n=r.get(a,o),h=this.get(t+a-i,e+o-i);for(let t=0;t<3;t++)s[t]+=h[t]*n}return s}setAplha(t){for(let e=0;e<this.height;e++)for(let r=0;r<this.width;r++){let i=this.get(r,e);this.set(r,e,[i[0],i[1],i[2],t])}return this}scale(t,e){return this.resize(Math.round(this.width*t),Math.round(this.height*e))}resize(t,e){const r=new GeonImage(t,e,this.pixelSize),i=this,s=1/r.width*i.width,o=1/r.height*i.height;for(let t=0;t<r.height;t++)for(let e=0;e<r.width;e++){let n=i.get(Math.round(e*s),Math.round(t*o));r.set(e,t,n)}return r}buffer(t,e){const r=new GeonImage(t,e,this.pixelSize),i=this;for(let s=0;s<e;s++)for(let e=0;e<t;e++){let t=i.includes(e,s)?i.get(e,s):[0,0,0,255];r.set(e,s,t)}return r}trimWithDomain(t){const e=Math.round(t.x.t0),r=Math.round(t.x.t1),i=Math.round(t.y.t0),s=Math.round(t.y.t1);return this.trim(e,i,r,s)}trim(t,e,r,i){const s=r-t,o=i-e,n=new GeonImage(s,o,this.pixelSize);for(let r=0;r<o;r++)for(let i=0;i<s;i++){let s=this.get(i+t,r+e);n.set(i,r,s)}return n}toGreyscale(){if(4!=this.pixelSize)throw"please, only use this when pixelsize is 4";let t=new GeonImage(this.width,this.height,4);for(let e=0;e<this.height;e++)for(let r=0;r<this.width;r++){let i=this.get(r,e),s=(i[0]+i[1]+i[2])/3;t.set(r,e,[s,s,s,255])}return t}toRGBA(){return this}}e.GeonImage=GeonImage},2099:(t,e,r)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.Kernels=void 0;const i=r(9742);class Kernels{static generateGaussianKernel(t,e){var r,s,o,n,a,h,l,u,c,d,m,f,g,p,w,x;for(a=t,2.718,n=new i.FloatMatrix(e,e),h=0,s=c=0,g=e-1;0<=g?c<=g:c>=g;s=0<=g?++c:--c)for(l=-(e-1)/2+s,o=d=0,p=e-1;0<=p?d<=p:d>=p;o=0<=p?++d:--d)u=-(e-1)/2+o,r=1/(2*Math.PI*a*a)*Math.pow(2.718,-(l*l+u*u)/(2*a*a)),n.set(s,o,r),h+=r;for(s=m=0,w=e-1;0<=w?m<=w:m>=w;s=0<=w?++m:--m)for(o=f=0,x=e-1;0<=x?f<=x:f>=x;o=0<=x?++f:--f)n.set(s,o,n.get(s,o)/h);return n}}e.Kernels=Kernels,Kernels.SmoothKernel=new i.FloatMatrix(3,3,[1,1,1,1,1,1,1,1,1]).forEachValue((t=>1*t/9)),Kernels.SmoothKernel5=new i.FloatMatrix(5,5,[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1]).forEachValue((t=>1*t/25)),Kernels.Gauss5=new i.FloatMatrix(5,5,[2,4,5,4,2,4,9,12,9,4,5,12,15,12,5,4,9,12,9,4,2,4,5,4,2]).forEachValue((t=>1*t/159)),Kernels.TestKernel=new i.FloatMatrix(3,3,[1,0,-1,0,0,0,-1,0,1]),Kernels.SobelLeft=new i.FloatMatrix(3,3,[1,2,1,0,0,0,-1,-2,-1]),Kernels.SobelRight=new i.FloatMatrix(3,3,[-1,-2,-1,0,0,0,1,2,1]),Kernels.SobelUp=new i.FloatMatrix(3,3,[1,0,-1,2,0,-2,1,0,-1]),Kernels.SobelDown=new i.FloatMatrix(3,3,[-1,0,1,-2,0,2,-1,0,1])},4735:function(t,e,r){var i=this&&this.__createBinding||(Object.create?function(t,e,r,i){void 0===i&&(i=r),Object.defineProperty(t,i,{enumerable:!0,get:function(){return e[r]}})}:function(t,e,r,i){void 0===i&&(i=r),t[i]=e[r]}),s=this&&this.__exportStar||function(t,e){for(var r in t)"default"===r||Object.prototype.hasOwnProperty.call(e,r)||i(e,t,r)};Object.defineProperty(e,"__esModule",{value:!0}),s(r(1006),e),s(r(2267),e),s(r(1138),e),s(r(5134),e),s(r(9742),e),s(r(8299),e),s(r(7810),e),s(r(9593),e),s(r(8837),e),s(r(3173),e),s(r(3986),e),s(r(9782),e),s(r(6583),e),s(r(232),e),s(r(4540),e),s(r(9907),e),s(r(3300),e),s(r(7603),e),s(r(191),e),s(r(6820),e),s(r(4013),e),s(r(1495),e),s(r(6652),e),s(r(5652),e),s(r(2914),e),s(r(6829),e),s(r(5817),e),s(r(5886),e),s(r(8773),e),s(r(2504),e),s(r(1822),e),s(r(7596),e),s(r(5739),e),s(r(1220),e),s(r(1778),e),s(r(3441),e),s(r(3324),e),s(r(7063),e),s(r(1220),e),s(r(2871),e),s(r(9735),e),s(r(8093),e),s(r(4085),e),s(r(5622),e),s(r(2099),e),s(r(5435),e),s(r(8265),e),s(r(3747),e),s(r(2984),e),s(r(8390),e),s(r(2307),e),s(r(1930),e),s(r(4925),e),s(r(530),e),s(r(5537),e),s(r(9381),e),s(r(5557),e),s(r(7854),e),s(r(321),e),s(r(7356),e),s(r(2474),e),s(r(5282),e),s(r(2808),e),s(r(5620),e),s(r(3538),e),s(r(4109),e)},6583:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.Const=void 0;class Const{static IsRouglyZero(t){return Math.abs(t)<this.TOLERANCE}}e.Const=Const,Const.TOLERANCE=1e-4,Const.TOL_SQUARED=Const.TOLERANCE**2,Const.MAX_U16=65536,Const.PLANE_RENDER_LINECOUNT=9,Const.PLANE_RENDER_LINEDISTANCE=.3,Const.CIRCLE_SEGMENTS=100,Const.BEZIER_SEGMENTS=100},232:(t,e,r)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.Domain3=e.Domain2=e.Domain=void 0;const i=r(4735);r(8663);class Domain{constructor(t=0,e=1){this.t0=t,this.t1=e}static new(t=0,e=1){return new Domain(t,e)}static fromRadius(t){return new Domain(-t,t)}static fromInclude(t){let e=Number.MAX_VALUE,r=Number.MIN_VALUE;for(let i=0;i<t.length;i++)t[i]<e&&(e=t[i]),t[i]>r&&(r=t[i]);return new Domain(e,r)}offset(t,e){return this.t0+=t,this.t1+=e,this}includes(t){return t>=this.t0&&t<=this.t1}size(){return this.t1-this.t0}normalize(t){return(t-this.t0)/this.size()}elevate(t){return t*this.size()+this.t0}lerp(t){return this.elevate(t)}remap(t,e=new Domain){let r=this.normalize(t);return e.elevate(r)}spawn(t){let e=new Float32Array(t),r=this.size()/(t-1);for(let i=0;i<t;i++)e[i]=this.t0+i*r;return e}*iter(t){let e=this.size()/(t-1);for(let r=0;r<t;r++){let t=this.t0+r*e;yield t}}*iterStep(t){for(let e=this.t0;e<=this.t1;e+=t)yield e}comform(t){return t<this.t0?this.t0:t>this.t1?this.t1:t}}e.Domain=Domain;class Domain2{constructor(t=new Domain,e=new Domain){this.x=t,this.y=e}static fromRadii(t,e){return new Domain2(Domain.fromRadius(t),Domain.fromRadius(e))}static fromRadius(t){return new Domain2(Domain.fromRadius(t),Domain.fromRadius(t))}static fromBounds(t,e,r,i){return new Domain2(new Domain(t,e),new Domain(r,i))}static fromWH(t,e,r,i){return new Domain2(new Domain(t,t+r),new Domain(e,e+i))}static fromInclude(t){let e=t.toMatrixSlice();return new Domain2(Domain.fromInclude(e.getColumn(0)),Domain.fromInclude(e.getColumn(1)))}offset(t){let e=t;if(4!=e.length)throw"need 4 values";return this.x.offset(e[0],e[1]),this.y.offset(e[2],e[3]),this}includes(t){return this.x.includes(t.x)&&this.y.includes(t.y)}size(){return new i.Vector2(this.x.size(),this.y.size())}normalize(t){return new i.Vector2(this.x.normalize(t.x),this.y.normalize(t.y))}elevate(t){return new i.Vector2(this.x.elevate(t.x),this.y.elevate(t.y))}remap(t,e=new Domain2){let r=this.normalize(t);return e.elevate(r)}corners(){let t=[];for(let e of[this.x.t0,this.x.t1])for(let r of[this.y.t0,this.y.t1])t.push(new i.Vector2(e,r));return t}spawn(t,e){let r=i.MultiVector2.new(t*e),s=0,o=this.y.spawn(e),n=this.x.spawn(t);for(const t of o)for(const e of n)r.setXY(s,e,t),s++;return r}populate(t,e){let r=i.MultiVector2.new(t);for(let t=0;t<r.count;t++)r.set(t,this.elevate(i.Vector2.fromRandom(e)));return r}}e.Domain2=Domain2;class Domain3{constructor(t=new Domain,e=new Domain,r=new Domain){this.x=t,this.y=e,this.z=r}static fromBounds(t,e,r,i,s,o){return new Domain3(new Domain(t,e),new Domain(r,i),new Domain(s,o))}static fromRadius(t){return new Domain3(Domain.fromRadius(t),Domain.fromRadius(t),Domain.fromRadius(t))}static fromRadii(t,e,r){return new Domain3(Domain.fromRadius(t),Domain.fromRadius(e),Domain.fromRadius(r))}static fromInclude(t){return new Domain3(Domain.fromInclude(t.slice().getColumn(0)),Domain.fromInclude(t.slice().getColumn(1)),Domain.fromInclude(t.slice().getColumn(2)))}offset(t){let e=t;if(6!=e.length)throw"need 6 values";return this.x.offset(e[0],e[1]),this.y.offset(e[2],e[3]),this.z.offset(e[4],e[5]),this}includes(t){return this.x.includes(t.x)&&this.y.includes(t.y)&&this.z.includes(t.z)}size(){return new i.Vector3(this.x.size(),this.y.size(),this.z.size())}normalize(t){return new i.Vector3(this.x.normalize(t.x),this.y.normalize(t.y),this.z.normalize(t.z))}elevate(t){return new i.Vector3(this.x.elevate(t.x),this.y.elevate(t.y),this.z.elevate(t.z))}remap(t,e=new Domain3){let r=this.normalize(t);return e.elevate(r)}remapAll(t,e=new Domain3){let r=i.MultiVector3.new(t.count);for(let i=0;i<t.count;i++){let s=this.normalize(t.get(i));r.set(i,e.elevate(s))}return r}corners(t){let e=[];for(let r of[this.x.t0,this.x.t1])for(let s of[this.y.t0,this.y.t1])for(let o of[this.z.t0,this.z.t1])e.push(t.multiplyVector(new i.Vector3(r,s,o)));return e}spawn(t,e,r){let s=i.MultiVector3.new(t*e),o=0,n=this.z.spawn(r),a=this.y.spawn(e),h=this.x.spawn(t);for(const t of n)for(const e of a)for(const r of h)s.setXYZ(o,r,e,t),o++;return s}populate(t,e){let r=i.MultiVector3.new(t);for(let t=0;t<r.count;t++)r.set(t,this.elevate(i.Vector3.fromRandom(e)));return r}}e.Domain3=Domain3},4540:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.GeonMath=void 0;e.GeonMath=class GeonMath{static clamp(t,e,r){return Math.min(Math.max(t,e),r)}static smooth(t){return t*t*t*(t*(6*t-15)+10)}static fraction(t,e,r){return(t-e)/(r-e)}static lerp(t,e,r){return t+r*(e-t)}static radToDeg(t){return 180*t/Math.PI}static degToRad(t){return t*Math.PI/180}static factorial(t){let e=1;for(let r=1;r<t+1;r++)e*=r;return e}static stack(t){let e=0;for(let r=1;r<t+1;r++)e+=r;return e}static sample(t,e){let r=e*(t.length-1),i=Math.floor(r),s=Math.ceil(r);return this.lerp(t[i],t[s],r-i)}static sampleSmooth(t,e){let r=e*(t.length-1),i=Math.floor(r),s=Math.ceil(r);return this.lerp(t[i],t[s],this.smooth(r-i))}static between(t,e){let r=0,i=t.length-1;for(let s=0;s<t.length;s++){if(r>i){console.log("start",r,"end",i);let t=i;i=r,r=t;break}let s=Math.round((i-r)/2);if(e<t[s])r=s;else{if(!(e>t[s])){r=s,i=s;break}i=s}}return[r,i]}}},9907:(t,e,r)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.Matrix4=e.Matrix3=void 0;const i=r(9742),s=r(4013);class Matrix3 extends i.FloatMatrix{constructor(t=[]){super(3,3,t)}static newIdentity(){return new Matrix3([1,0,0,0,1,0,0,0,1])}static newProjection(t,e){return new Matrix3([2/t,0,0,0,-2/e,0,-1,1,1])}static newTranslation(t,e){return new Matrix3([1,0,0,0,1,0,t,e,1])}static newRotation(t){var e=Math.cos(t),r=Math.sin(t);return new Matrix3([e,-r,0,r,e,0,0,0,1])}static newScalar(t,e){return new Matrix3([t,0,0,0,e,0,0,0,1])}toMat4(){let t=this.data;return new Matrix4([t[0],t[1],0,t[2],t[3],t[4],0,t[5],0,0,1,0,t[6],t[7],0,t[8]])}project(t,e){return this.multiply(Matrix3.newProjection(t,e))}translateN(t,e){return this.multiply(Matrix3.newTranslation(t,e))}translate(t){return this.multiply(Matrix3.newTranslation(t.x,t.y))}rotate(t){return this.multiply(Matrix3.newRotation(t))}scale(t,e){return this.multiply(Matrix3.newScalar(t,e))}multiply(t){let e=this.data,r=t.data;var i=e[0],s=e[1],o=e[2],n=e[3],a=e[4],h=e[5],l=e[6],u=e[7],c=e[8],d=r[0],m=r[1],f=r[2],g=r[3],p=r[4],w=r[5],x=r[6],v=r[7],_=r[8];return new Matrix3([d*i+m*n+f*l,d*s+m*a+f*u,d*o+m*h+f*c,g*i+p*n+w*l,g*s+p*a+w*u,g*o+p*h+w*c,x*i+v*n+_*l,x*s+v*a+_*u,x*o+v*h+_*c])}transformVector(t){let e=this.data,r=t.x,i=t.y,s=r*e[2]+i*e[5]+e[8];return t.x=(r*e[0]+i*e[3]+e[6])/s,t.y=(r*e[1]+i*e[4]+e[7])/s,t}inverse(){let t=this.data;var e=t[4]*t[8]-t[5]*t[7],r=t[1]*t[8]-t[2]*t[7],i=t[1]*t[5]-t[2]*t[4],s=1/(t[0]*e-t[3]*r+t[6]*i);return this.setData([s*e,-s*r,s*i,-s*(t[3]*t[8]-t[5]*t[6]),s*(t[0]*t[8]-t[2]*t[6]),-s*(t[0]*t[5]-t[2]*t[3]),s*(t[3]*t[7]-t[4]*t[6]),-s*(t[0]*t[7]-t[1]*t[6]),s*(t[0]*t[4]-t[1]*t[3])]),this}}e.Matrix3=Matrix3;class Matrix4 extends i.FloatMatrix{constructor(t=[]){super(4,4,t)}static new(t){return new Matrix4(t)}static newIdentity(){return new Matrix4([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])}static newCopy(t){let e=new Matrix4;for(let r=0;r<16;r++)e.data[r]=t.data[r];return e}clone(){return Matrix4.newCopy(this)}multiplied(t){const e=t.data,r=this.data;var i=r[0],s=r[1],o=r[2],n=r[3],a=r[4],h=r[5],l=r[6],u=r[7],c=r[8],d=r[9],m=r[10],f=r[11],g=r[12],p=r[13],w=r[14],x=r[15],v=e[0],_=e[1],M=e[2],y=e[3],b=e[4],V=e[5],R=e[6],A=e[7],E=e[8],P=e[9],S=e[10],T=e[11],D=e[12],L=e[13],F=e[14],C=e[15];return new Matrix4([i*v+s*b+o*E+n*D,i*_+s*V+o*P+n*L,i*M+s*R+o*S+n*F,i*y+s*A+o*T+n*C,a*v+h*b+l*E+u*D,a*_+h*V+l*P+u*L,a*M+h*R+l*S+u*F,a*y+h*A+l*T+u*C,c*v+d*b+m*E+f*D,c*_+d*V+m*P+f*L,c*M+d*R+m*S+f*F,c*y+d*A+m*T+f*C,g*v+p*b+w*E+x*D,g*_+p*V+w*P+x*L,g*M+p*R+w*S+x*F,g*y+p*A+w*T+x*C])}multiply(t){return this.data=this.multiplied(t).data,this}transpose(){let t=new Matrix4,e=t.data,r=this.data;return e[0]=r[0],e[1]=r[4],e[2]=r[8],e[3]=r[12],e[4]=r[1],e[5]=r[5],e[6]=r[9],e[7]=r[13],e[8]=r[2],e[9]=r[6],e[10]=r[10],e[11]=r[14],e[12]=r[3],e[13]=r[7],e[14]=r[11],e[15]=r[15],t}static newLookAt(t,e,r){let i=new Matrix4,s=i.data,o=t.clone().sub(e).normalize(),n=r.clone().cross(r).normalize(),a=o.clone().cross(n).normalize();return s[0]=n.x,s[1]=n.y,s[2]=n.z,s[3]=0,s[4]=a.x,s[5]=a.y,s[6]=a.z,s[7]=0,s[8]=o.x,s[9]=o.y,s[10]=o.z,s[11]=0,s[12]=t.x,s[13]=t.y,s[14]=t.z,s[15]=1,i}static newPerspective(t,e,r,i){let s=new Matrix4,o=s.data;var n=Math.tan(.5*Math.PI-.5*t),a=1/(r-i);return o[0]=n/e,o[1]=0,o[2]=0,o[3]=0,o[4]=0,o[5]=n,o[6]=0,o[7]=0,o[8]=0,o[9]=0,o[10]=(r+i)*a,o[11]=-1,o[12]=0,o[13]=0,o[14]=r*i*a*2,o[15]=0,s}static newOrthographic(t,e,r,i,s,o){let n=new Matrix4,a=n.data;return a[0]=2/(e-t),a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=2/(i-r),a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[10]=2/(s-o),a[11]=0,a[12]=(t+e)/(t-e),a[13]=(r+i)/(r-i),a[14]=(s+o)/(s-o),a[15]=1,n}static newFrustum(t,e,r,i,s,o){let n=new Matrix4,a=n.data;var h=e-t,l=i-r,u=o-s;return a[0]=2*s/h,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=2*s/l,a[6]=0,a[7]=0,a[8]=(t+e)/h,a[9]=(i+r)/l,a[10]=-(o+s)/u,a[11]=-1,a[12]=0,a[13]=0,a[14]=-2*s*o/u,a[15]=0,n}static newTranslation(t,e,r){return new Matrix4([1,0,0,0,0,1,0,0,0,0,1,0,t,e,r,1])}static newTranslate(t){return new Matrix4([1,0,0,0,0,1,0,0,0,0,1,0,t.x,t.y,t.z,1])}static newXRotation(t){var e=Math.cos(t),r=Math.sin(t);return new Matrix4([1,0,0,0,0,e,-r,0,0,r,e,0,0,0,0,1])}static newYRotation(t){var e=Math.cos(t),r=Math.sin(t);return new Matrix4([e,0,r,0,0,1,0,0,-r,0,e,0,0,0,0,1])}static newZRotation(t){let e=new Matrix4,r=e.data;var i=Math.cos(t),s=Math.sin(t);return r[0]=i,r[1]=s,r[2]=0,r[3]=0,r[4]=-s,r[5]=i,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[10]=1,r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,e}static newAxisRotation(t,e){let r=new Matrix4,i=r.data,s=t.x,o=t.y,n=t.z,a=Math.sqrt(s*s+o*o+n*n);s/=a,o/=a,n/=a;let h=s*s,l=o*o,u=n*n,c=Math.cos(e),d=Math.sin(e),m=1-c;return i[0]=h+(1-h)*c,i[1]=s*o*m+n*d,i[2]=s*n*m-o*d,i[3]=0,i[4]=s*o*m-n*d,i[5]=l+(1-l)*c,i[6]=o*n*m+s*d,i[7]=0,i[8]=s*n*m+o*d,i[9]=o*n*m-s*d,i[10]=u+(1-u)*c,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,r}axisRotate(t,e){let r=new Matrix4,i=r.data,s=this.data;var o=t.x,n=t.y,a=t.z,h=Math.sqrt(o*o+n*n+a*a),l=(o/=h)*o,u=(n/=h)*n,c=(a/=h)*a,d=Math.cos(e),m=Math.sin(e),f=1-d,g=l+(1-l)*d,p=o*n*f+a*m,w=o*a*f-n*m,x=o*n*f-a*m,v=u+(1-u)*d,_=n*a*f+o*m,M=o*a*f+n*m,y=n*a*f-o*m,b=c+(1-c)*d,V=s[0],R=s[1],A=s[2],E=s[3],P=s[4],S=s[5],T=s[6],D=s[7],L=s[8],F=s[9],C=s[10],z=s[11];return i[0]=g*V+p*P+w*L,i[1]=g*R+p*S+w*F,i[2]=g*A+p*T+w*C,i[3]=g*E+p*D+w*z,i[4]=x*V+v*P+_*L,i[5]=x*R+v*S+_*F,i[6]=x*A+v*T+_*C,i[7]=x*E+v*D+_*z,i[8]=M*V+y*P+b*L,i[9]=M*R+y*S+b*F,i[10]=M*A+y*T+b*C,i[11]=M*E+y*D+b*z,s!==i&&(i[12]=s[12],i[13]=s[13],i[14]=s[14],i[15]=s[15]),r}static newScaler(t,e,r){return new Matrix4([t,0,0,0,0,e,0,0,0,0,r,0,0,0,0,1])}scale(t,e,r){let i=new Matrix4,s=i.data,o=this.data;return s[0]=t*o[0],s[1]=t*o[1],s[2]=t*o[2],s[3]=t*o[3],s[4]=e*o[4],s[5]=e*o[5],s[6]=e*o[6],s[7]=e*o[7],s[8]=r*o[8],s[9]=r*o[9],s[10]=r*o[10],s[11]=r*o[11],o!==s&&(s[12]=o[12],s[13]=o[13],s[14]=o[14],s[15]=o[15]),i}newCompose(t,e,r){let i=new Matrix4,s=i.data;const o=e.x,n=e.y,a=e.z,h=e.w,l=o+o,u=n+n,c=a+a,d=o*l,m=o*u,f=o*c,g=n*u,p=n*c,w=a*c,x=h*l,v=h*u,_=h*c,M=r.x,y=r.y,b=r.z;return s[0]=(1-(g+w))*M,s[1]=(m+_)*M,s[2]=(f-v)*M,s[3]=0,s[4]=(m-_)*y,s[5]=(1-(d+w))*y,s[6]=(p+x)*y,s[7]=0,s[8]=(f+v)*b,s[9]=(p-x)*b,s[10]=(1-(d+g))*b,s[11]=0,s[12]=t.x,s[13]=t.y,s[14]=t.z,s[15]=1,i}determinate(){let t=this.data;var e=t[0],r=t[1],i=t[2],s=t[3],o=t[4],n=t[5],a=t[6],h=t[7],l=t[8],u=t[9],c=t[10],d=t[11],m=t[12],f=t[13],g=t[14],p=t[15],w=c*p,x=g*d,v=a*p,_=g*h,M=a*d,y=c*h,b=i*p,V=g*s,R=i*d,A=c*s,E=i*h,P=a*s;return 1/(e*(w*n+_*u+M*f-(x*n+v*u+y*f))+o*(x*r+b*u+A*f-(w*r+V*u+R*f))+l*(v*r+V*n+E*f-(_*r+b*n+P*f))+m*(y*r+R*n+P*u-(M*r+A*n+E*u)))}inverse(){let t=new Matrix4,e=t.data,r=this.data;var i=r[0],s=r[1],o=r[2],n=r[3],a=r[4],h=r[5],l=r[6],u=r[7],c=r[8],d=r[9],m=r[10],f=r[11],g=r[12],p=r[13],w=r[14],x=r[15],v=m*x,_=w*f,M=l*x,y=w*u,b=l*f,V=m*u,R=o*x,A=w*n,E=o*f,P=m*n,S=o*u,T=l*n,D=c*p,L=g*d,F=a*p,C=g*h,z=a*d,I=c*h,B=i*p,N=g*s,U=i*d,k=c*s,O=i*h,j=a*s,G=v*h+y*d+b*p-(_*h+M*d+V*p),Y=_*s+R*d+P*p-(v*s+A*d+E*p),q=M*s+A*h+S*p-(y*s+R*h+T*p),W=V*s+E*h+T*d-(b*s+P*h+S*d),K=1/(i*G+a*Y+c*q+g*W);return e[0]=K*G,e[1]=K*Y,e[2]=K*q,e[3]=K*W,e[4]=K*(_*a+M*c+V*g-(v*a+y*c+b*g)),e[5]=K*(v*i+A*c+E*g-(_*i+R*c+P*g)),e[6]=K*(y*i+R*a+T*g-(M*i+A*a+S*g)),e[7]=K*(b*i+P*a+S*c-(V*i+E*a+T*c)),e[8]=K*(D*u+C*f+z*x-(L*u+F*f+I*x)),e[9]=K*(L*n+B*f+k*x-(D*n+N*f+U*x)),e[10]=K*(F*n+N*u+O*x-(C*n+B*u+j*x)),e[11]=K*(I*n+U*u+j*f-(z*n+k*u+O*f)),e[12]=K*(F*m+I*w+L*l-(z*w+D*l+C*m)),e[13]=K*(U*w+D*o+N*m-(B*m+k*w+L*o)),e[14]=K*(B*l+j*w+C*o-(O*w+F*o+N*l)),e[15]=K*(O*m+z*o+k*l-(U*l+j*m+I*o)),t}multiplyVector(t){let e=new Array(3);for(var r=0;r<3;++r){e[r]=0;for(var i=0;i<4;++i)e[r]+=t.item(i)*this.get(i,r)}return new s.Vector3(e[0],e[1],e[2])}multipliedVectorList(t){let e=Array(t.length);for(let r=0;r<t.length;r++)e[r]=this.multiplyVector(t[r]);return e}}e.Matrix4=Matrix4},3880:(t,e,r)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.Polynomial=void 0;const i=r(3986),s=r(4540),o=r(6820);class Polynomial{static bernstein(t,e,r){return this.getBicoef(r,e)*Math.pow(t,e)*Math.pow(1-t,r-e)}static coxdeboor(t,e,r,i){if(0==r)return t>=i[e]&&t<i[e+1]?1:0;let s=i[e+r]-i[e],o=i[e+r+1]-i[e+1],n=(t-i[e])/s,a=(i[e+r+1]-t)/o;return n*this.coxdeboor(t,e,r-1,i)+a*this.coxdeboor(t,e+1,r-1,i)}static coxdeboorTriangle(t,e,r,i){let n=i.length,a=new Float32Array(s.GeonMath.stack(n)),h=o.Util.iterateTriangle,l=n-1;for(let r=0;r<=l;r++){let s=h(l,r);(i[e]<=t||t<i[e+1])&&(a[s]=1),a[s]=0}for(let s=n-2;s>-1;s-=1)for(let o=0;o<=s;o++){let n=h(s,o),l=a[h(s+1,o)],u=a[h(s+1,o+1)],c=(t-i[e])/(i[e+r]-i[e]),d=(i[e+r+1]-t)/(i[e+r+1]-i[e+1]);a[n]=c*l+d*u}return a}static getBicoef(t,e){return this._pascal[t][e]}static calcBicoef(t,e){let r=s.GeonMath.factorial;return r(t)/(r(e)*r(t-e))}static calcPascal(t){let e=Array(t);for(let r=0;r<t;r++){e[r]=Array(r+1);for(let t=0;t<r+1;t++)e[r][t]=this.calcBicoef(r,t)}return e}static decastejau(t,e){let r=t.count,n=i.MultiVector3.new(s.GeonMath.stack(r)),a=o.Util.iterateTriangle,h=r-1,l=0;for(let e=0;e<=h;e++){let r=a(h,e);n.set(r,t.get(l)),l++}for(let t=r-2;t>-1;t-=1)for(let r=0;r<=t;r++){let i=a(t,r),s=n.get(a(t+1,r)),o=n.get(a(t+1,r+1)).scale(e).add(s.scale(1-e));n.set(i,o)}return n}static decastejauExtrapolateEnd(t,e){let r=t.count,n=i.MultiVector3.new(s.GeonMath.stack(r)),a=o.Util.iterateTriangle,h=0;for(let e=r-1;e>-1;e-=1){let r=a(e,0);n.set(r,t.get(h)),h++}for(let t=1;t<r;t++)for(let r=1;r<=t;r++){let i=a(t-1,r-1),s=a(t,r-1),o=a(t,r),h=n.get(s).lerp(n.get(i),1+e);n.set(o,h)}return n}static decastejauExtrapolateStart(t,e){let r=t.count,n=i.MultiVector3.new(s.GeonMath.stack(r)),a=o.Util.iterateTriangle,h=r-1,l=0;for(let e=0;e<=h;e++){let r=a(h,e);n.set(r,t.get(l)),l++}for(let t=r-2;t>-1;t-=1)for(let r=0;r<=t;r++){let i=a(t,r),s=n.get(a(t+1,r)),o=n.get(a(t+1,r+1)).scale(e).add(s.scale(1-e));n.set(i,o)}return n}}e.Polynomial=Polynomial,Polynomial.MAX_DEGREE=15,Polynomial._pascal=Polynomial.calcPascal(Polynomial.MAX_DEGREE)},3300:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.Quaternion=void 0;e.Quaternion=class Quaternion{constructor(t,e,r,i){this.x=t,this.y=e,this.z=r,this.w=i}}},7921:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.createRandomGUID=e.createGUID=e.Random=void 0;class Random{constructor(t,e,r,i){this.a=t,this.b=e,this.c=r,this.d=i}static new(t,e,r,i){return new Random(t,e,r,i)}static randomSeed(){return 393847477636*Math.random()}static fromSeed(t){for(var e=3735928559^t,r=Random.new(2654435769,608135816,3084996962,e),i=0;i<15;i++)r.get();return r}static fromRandom(){return this.fromSeed(103948857*Math.random())}static fromHash(t){var e=function xmur3(t){for(var e=0,r=1779033703^t.length;e<t.length;e++)r=(r=Math.imul(r^t.charCodeAt(e),3432918353))<<13|r>>>19;return function(){return r=Math.imul(r^r>>>16,2246822507),r=Math.imul(r^r>>>13,3266489909),(r^=r>>>16)>>>0}}(t);return this.new(e(),e(),e(),e())}get(){this.a>>>=0,this.b>>>=0,this.c>>>=0,this.d>>>=0;let t=this.a+this.b|0;return this.a=this.b^this.b>>>9,this.b=this.c+(this.c<<3)|0,this.c=this.c<<21|this.c>>>11,this.d=this.d+1|0,t=t+this.d|0,this.c=this.c+t|0,(t>>>0)/4294967296}}function createGUID(t){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(e){var r=16*t.get()|0;return("x"==e?r:3&r|8).toString(16)}))}e.Random=Random,e.createGUID=createGUID,e.createRandomGUID=function createRandomGUID(){return createGUID(Random.fromRandom())}},7603:(t,e,r)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.Ray=void 0;const i=r(6652);class Ray{constructor(t,e){this.origin=t,this.normal=e.normalize()}static fromNormal(t,e){return new Ray(t,e)}static fromPoints(t,e){return new Ray(t,e.subbed(t).normalize())}at(t){return this.origin.added(this.normal.scaled(t))}xPlane(t){return-(this.origin.dot(t.normal)+t.d)/this.normal.dot(t.normal)}toLine(t){let e=this.at(t);return i.MultiLine.fromLines([this.origin,e])}}e.Ray=Ray},191:(t,e,r)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.Stat=void 0;const i=r(9742);e.Stat=class Stat{static sum(t){let e=0;for(let r=0;r<t.length;r++)e+=t[r];return e}static mean(t){return this.sum(t)/t.length}static meanWeighted(t,e){if(t.length!=e.length)throw new Error("values & weights need same length");var r=0,i=0;for(let s=0;s<t.length;s++)r+=t[s]*e[s],i+=e[s];return r/i}static variance(t){let e=t.length,r=this.mean(t),i=0;for(let s=0;s<e;s++)i+=(t[s]-r)**2;return i/(e-1)}static deviation(t){return this.variance(t)**.5}static covariance(t,e){if(t.length!=e.length)throw"this is not how covariance works...";let r=t.length,i=this.mean(t),s=this.mean(e),o=0;for(let n=0;n<r;n++)o+=(t[n]-i)*(e[n]-s);return o/(r-1)}static cov(t){let e=t.width,r=new i.FloatMatrix(e,e),s=Array(e);for(let r=0;r<e;r++)s[r]=t.getColumn(r);for(let t=0;t<e;t++)for(let i=t;i<e;i++){let e=this.covariance(s[t],s[i]);r.set(t,i,e),r.set(i,t,e)}return r}static eig(t){let e=this.svd(t);return[e[1],e[2]]}static svd(t){var e=Math.pow(2,-52),r=1e-64/e,s=0,o=0,n=0,a=0,h=0,l=t.clone().toNative(),u=l.length,c=l[0].length;if(u<c)throw"Need more rows than columns";var d=new Array(c),m=new Array(c);for(o=0;o<c;o++)d[o]=m[o]=0;var f=function rep(t,e,r=0){let i,s=t[r],o=Array(s);if(r===t.length-1){for(i=s-2;i>=0;i-=2)o[i+1]=e,o[i]=e;return-1===i&&(o[0]=e),o}for(i=s-1;i>=0;i--)o[i]=rep(t,e,r+1);return o}([c,c],0);function pythag(t,e){return(t=Math.abs(t))>(e=Math.abs(e))?t*Math.sqrt(1+e*e/t/t):0==e?t:e*Math.sqrt(1+t*t/e/e)}var g,p=0,w=0,x=0,v=0,_=0,M=0,y=0;for(o=0;o<c;o++){for(d[o]=w,y=0,h=o+1,n=o;n<u;n++)y+=l[n][o]*l[n][o];if(y<=r)w=0;else for(p=l[o][o],w=Math.sqrt(y),p>=0&&(w=-w),x=p*w-y,l[o][o]=p-w,n=h;n<c;n++){for(y=0,a=o;a<u;a++)y+=l[a][o]*l[a][n];for(p=y/x,a=o;a<u;a++)l[a][n]+=p*l[a][o]}for(m[o]=w,y=0,n=h;n<c;n++)y+=l[o][n]*l[o][n];if(y<=r)w=0;else{for(p=l[o][o+1],w=Math.sqrt(y),p>=0&&(w=-w),x=p*w-y,l[o][o+1]=p-w,n=h;n<c;n++)d[n]=l[o][n]/x;for(n=h;n<u;n++){for(y=0,a=h;a<c;a++)y+=l[n][a]*l[o][a];for(a=h;a<c;a++)l[n][a]+=y*d[a]}}(_=Math.abs(m[o])+Math.abs(d[o]))>v&&(v=_)}for(o=c-1;-1!=o;o+=-1){if(0!=w){for(x=w*l[o][o+1],n=h;n<c;n++)f[n][o]=l[o][n]/x;for(n=h;n<c;n++){for(y=0,a=h;a<c;a++)y+=l[o][a]*f[a][n];for(a=h;a<c;a++)f[a][n]+=y*f[a][o]}}for(n=h;n<c;n++)f[o][n]=0,f[n][o]=0;f[o][o]=1,w=d[o],h=o}for(o=c-1;-1!=o;o+=-1){for(h=o+1,w=m[o],n=h;n<c;n++)l[o][n]=0;if(0!=w){for(x=l[o][o]*w,n=h;n<c;n++){for(y=0,a=h;a<u;a++)y+=l[a][o]*l[a][n];for(p=y/x,a=o;a<u;a++)l[a][n]+=p*l[a][o]}for(n=o;n<u;n++)l[n][o]=l[n][o]/w}else for(n=o;n<u;n++)l[n][o]=0;l[o][o]+=1}for(e*=v,a=c-1;-1!=a;a+=-1)for(var b=0;b<50;b++){var V=!1;for(h=a;-1!=h;h+=-1){if(Math.abs(d[h])<=e){V=!0;break}if(Math.abs(m[h-1])<=e)break}if(!V){s=0,y=1;var R=h-1;for(o=h;o<a+1&&(p=y*d[o],d[o]=s*d[o],!(Math.abs(p)<=e));o++)for(x=pythag(p,w=m[o]),m[o]=x,s=w/x,y=-p/x,n=0;n<u;n++)_=l[n][R],M=l[n][o],l[n][R]=_*s+M*y,l[n][o]=-_*y+M*s}if(M=m[a],h==a){if(M<0)for(m[a]=-M,n=0;n<c;n++)f[n][a]=-f[n][a];break}if(b>=49)throw"Error: no convergence.";for(v=m[h],w=pythag(p=(((_=m[a-1])-M)*(_+M)+((w=d[a-1])-(x=d[a]))*(w+x))/(2*x*_),1),p=p<0?((v-M)*(v+M)+x*(_/(p-w)-x))/v:((v-M)*(v+M)+x*(_/(p+w)-x))/v,s=1,y=1,o=h+1;o<a+1;o++){for(w=d[o],_=m[o],x=y*w,w*=s,M=pythag(p,x),d[o-1]=M,p=v*(s=p/M)+w*(y=x/M),w=-v*y+w*s,x=_*y,_*=s,n=0;n<c;n++)v=f[n][o-1],M=f[n][o],f[n][o-1]=v*s+M*y,f[n][o]=-v*y+M*s;for(M=pythag(p,x),m[o-1]=M,p=(s=p/M)*w+(y=x/M)*_,v=-y*w+s*_,n=0;n<u;n++)_=l[n][o-1],M=l[n][o],l[n][o-1]=_*s+M*y,l[n][o]=-_*y+M*s}d[h]=0,d[a]=p,m[a]=v}for(o=0;o<m.length;o++)m[o]<e&&(m[o]=0);for(o=0;o<c;o++)for(n=o-1;n>=0;n--)if(m[n]<m[o]){for(s=m[n],m[n]=m[o],m[o]=s,a=0;a<l.length;a++)g=l[a][o],l[a][o]=l[a][n],l[a][n]=g;for(a=0;a<f.length;a++)g=f[a][o],f[a][o]=f[a][n],f[a][n]=g;o=n}return[i.FloatMatrix.fromNative(l),new Float32Array(m),i.FloatMatrix.fromNative(f)]}}},6820:(t,e,r)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.Util=void 0;const i=r(3986),s=r(4540),o=r(4013);class Util{static range(t){let e=[];for(let r=0;r<t;r++)e.push(r);return e}static collect(t){let e=new Array;for(let r of t)e.push(r);return e}static lowestScore(t,e,r=1e-10){let i=1/0;for(;t.t1-t.t0>r;)i=(t.t1+t.t0)/2,e(i-r)<e(i+r)?t.t1=i:t.t0=i;return i}static lowestScoreSquared(t,e,r=1e-10){let i=1/0,s=1/0;for(;t.x.t1-t.x.t0>r||t.y.t1-t.y.t0>r;)i=(t.x.t1+t.x.t0)/2,s=(t.y.t1+t.y.t0)/2,e(i-r,s)<e(i+r,s)?t.x.t1=i:t.x.t0=i,e(i,s-r)<e(i,s+r)?t.y.t1=s:t.y.t0=s;return o.Vector2.new(i,s)}static iterateTriangle(t,e){return s.GeonMath.stack(t)+e}static getTriangleBase(t,e){let r=i.MultiVector3.new(e),s=e-1,o=0;for(let e=0;e<=s;e++){let i=Util.iterateTriangle(s,e);r.set(o,t.get(i)),o++}return r}static getTriangleLeft(t,e){let r=i.MultiVector3.new(e),s=0;for(let i=e-1;i>-1;i-=1)r.set(s,t.get(Util.iterateTriangle(i,0))),s++;return r}static getTriangleRight(t,e){let r=i.MultiVector3.new(e),s=0;for(let i=e-1;i>-1;i-=1)r.set(s,t.get(Util.iterateTriangle(i,i))),s++;return r}}e.Util=Util},4013:(t,e,r)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.Vector2=e.Vector3=void 0;const i=r(6583),s=r(4540),o=r(9907),n=r(6820);class Vector3{constructor(t,e,r){this.x=t,this.y=e,this.z=r}static new(t=0,e=0,r=0){return new Vector3(t,e,r)}static calculateWheelOrder(t,e,r){let i=[];t.forEach((t=>{i.push(new Vector2(t.dot(e),t.dot(r)).angle())}));let s=n.Util.range(t.length);return s.sort(((t,e)=>i[t]-i[e])),s}static fromLerp(t,e,r){return new Vector3(t.x+(e.x-t.x)*r,t.y+(e.y-t.y)*r,t.z+(e.z-t.z)*r)}static fromArray(t){return new Vector3(t[0],t[1],t[2])}static fromRandom(t){return new Vector3(t.get(),t.get(),t.get())}static fromRandomUnit(t){return this.fromRandom(t).sub(Vector3.new(.5,.5,.5)).normalize()}static fromSphere(t,e,r){const i=Math.sin(r)*t;return this.constructor(i*Math.sin(e),Math.cos(r)*t,i*Math.cos(e))}static fromCylinder(t,e,r){return this.constructor(t*Math.sin(e),r,t*Math.cos(e))}static fromLerpWeights(t,e,r,i,s){if(Math.abs(s-r)<1e-5)return t;if(Math.abs(s-i)<1e-5)return e;if(Math.abs(r-i)<1e-5)return t;let o=(s-r)/(i-r);return new Vector3(t.x+o*(e.x-t.x),t.y+o*(e.y-t.y),t.z+o*(e.z-t.z))}static zero(){return new Vector3(0,0,0)}static unitX(){return new Vector3(1,0,0)}static unitY(){return new Vector3(0,1,0)}static unitZ(){return new Vector3(0,0,1)}toArray(){return new Float32Array([this.x,this.y,this.z])}set(t,e,r){return this.x=t,this.y=e,this.z=r,this}equals(t){return t.x===this.x&&t.y===this.y&&t.z===this.z}toString(){return`Vector3(${this.x}, ${this.y}, ${this.z})`}toVector2(){return new Vector2(this.x,this.y)}clone(){return new Vector3(this.x,this.y,this.z)}copy(t){return this.x=t.x,this.y=t.y,this.z=t.z,this}to2D(){return new Vector2(this.x,this.y)}largestValue(){return Math.max(this.x,this.y,this.z)}added(t){return new Vector3(this.x+t.x,this.y+t.y,this.z+t.z)}add(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this}subbed(t){return new Vector3(this.x-t.x,this.y-t.y,this.z-t.z)}sub(t){return this.x-=t.x,this.y-=t.y,this.z-=t.z,this}item(t){switch(t){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return 1;default:throw"nope"}}scaled(t){return new Vector3(this.x*t,this.y*t,this.z*t)}scale(t){return this.x*=t,this.y*=t,this.z*=t,this}mul(t){return this.x*=t.x,this.y*=t.y,this.z*=t.z,this}multiplied(t){return new Vector3(this.x*t.x,this.y*t.y,this.z*t.z)}divVector(t){return new Vector3(this.x/t.x,this.y/t.y,this.z/t.z)}divided(t){return new Vector3(this.x/t,this.y/t,this.z/t)}div(t){return this.x/=t,this.y/=t,this.z/=t,this}minimumed(t){return new Vector3(Math.min(this.x,t.x),Math.min(this.y,t.y),Math.min(this.z,t.z))}maximumed(t){return new Vector3(Math.max(this.x,t.x),Math.max(this.y,t.y),Math.max(this.z,t.z))}clamped(t,e){return new Vector3(Math.max(t.x,Math.min(e.x,this.x)),Math.max(t.y,Math.min(e.y,this.y)),Math.max(t.z,Math.min(e.z,this.z)))}clampScalared(t,e){return new Vector3(s.GeonMath.clamp(this.x,t,e),s.GeonMath.clamp(this.y,t,e),s.GeonMath.clamp(this.z,t,e))}clampLengthed(t,e){const r=this.length();return this.div(r||1).scale(Math.max(t,Math.min(e,r)))}floored(){return new Vector3(Math.floor(this.x),Math.floor(this.y),Math.floor(this.z))}ceiled(){return new Vector3(Math.ceil(this.x),Math.ceil(this.y),Math.ceil(this.z))}rounded(){return new Vector3(Math.round(this.x),Math.round(this.y),Math.round(this.z))}roundedToZero(){return new Vector3(this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z<0?Math.ceil(this.z):Math.floor(this.z))}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}negated(){return new Vector3(-this.x,-this.y,-this.z)}angle(t,e){let r=this.subbed(e.scaled(this.dot(e))),i=t.subbed(e.scaled(t.dot(e)));return console.log(r),console.log(i),0}dot(t){return this.x*t.x+this.y*t.y+this.z*t.z}cross(t){const e=this.x,r=this.y,i=this.z,s=t.x,o=t.y,n=t.z;return new Vector3(r*n-i*o,i*s-e*n,e*o-r*s)}getLengthSquared(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.getLengthSquared())}manhat(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.div(this.length()||1)}normalized(){return this.divided(this.length()||1)}isNormal(){return Math.abs(this.length()-1)<i.Const.TOLERANCE}disTo(t){return Math.sqrt(this.disToSquared(t))}disToSquared(t){const e=this.x-t.x,r=this.y-t.y,i=this.z-t.z;return e*e+r*r+i*i}disToManhat(t){return Math.abs(this.x-t.x)+Math.abs(this.y-t.y)+Math.abs(this.z-t.z)}setLength(t){return this.normalize().scale(t)}lerp(t,e){return Vector3.fromLerp(this,t,e)}projectOnVector(t){const e=t.getLengthSquared();if(0===e)return this.set(0,0,0);const r=t.dot(this)/e;return this.copy(t).scale(r)}projectedOnPlane(t){return a.copy(this).projectOnVector(t),this.minimumed(a)}mirrored(t){return this.minimumed(a.copy(t).scale(2*this.dot(t)))}rotated(t,e){return o.Matrix4.newAxisRotation(t,e).multiplyVector(this)}}e.Vector3=Vector3;const a=new Vector3(0,0,0);class Vector2{constructor(t,e){this.x=t,this.y=e}static new(t=0,e=0){return new Vector2(t,e)}static fromArray(t){return new Vector2(t[0],t[1])}static fromLerp(t,e,r){return new Vector2(t.x+(e.x-t.x)*r,t.y+(e.y-t.y)*r)}static fromRandom(t){return new Vector2(t.get(),t.get())}static fromRandomAngle(){let t=Math.random()*Math.PI*2;return new Vector2(Math.cos(t),Math.sin(t))}static fromCircle(t,e,r){return new Vector2(t.x+e*Math.sin(r),t.y+e*Math.cos(r))}static fromCopy(t){return this.zero().copy(t)}static zero(){return new Vector2(0,0)}static NaN(){return new Vector2(NaN,NaN)}static fromCircumcenter(t,e,r){const i=t.squareSum(),s=e.squareSum(),o=r.squareSum();let n=2*(t.x*(e.y-r.y)+e.x*(r.y-t.y)+r.x*(t.y-e.y));if(n<1e-6)return Vector2.NaN();let a=(i*(e.y-r.y)+s*(r.y-t.y)+o*(t.y-e.y))/n,h=(i*(r.x-e.x)+s*(t.x-r.x)+o*(e.x-t.x))/n;return new Vector2(a,h)}static getSign(t,e,r){return(t.x-r.x)*(e.y-r.y)-(e.x-r.x)*(t.y-r.y)}to3D(){return new Vector3(this.x,this.y,0)}set(t,e){return this.x=t,this.y=e,this}roughlyEquals(t,e){return Math.abs(this.x-t.x)<e&&Math.abs(this.y-t.y)<e}equals(t){return t.x===this.x&&t.y===this.y}toString(){return`Vector2(${this.x}, ${this.y})`}clone(){return new Vector2(this.x,this.y)}copy(t){return this.x=t.x,this.y=t.y,this}add(t){return this.x+=t.x,this.y+=t.y,this}added(t){return new Vector2(this.x+t.x,this.y+t.y)}addn(t,e){return this.x+=t,this.y+=e,this}sub(t){return this.x-=t.x,this.y-=t.y,this}subbed(t){return new Vector2(this.x-t.x,this.y-t.y)}mul(t){return this.x*=t.x,this.y*=t.y,this}scale(t){return this.x*=t,this.y*=t,this}scaled(t){return new Vector2(this.x*t,this.y*t)}divVector(t){return this.x/=t.x,this.y/=t.y,this}div(t){return this.x/=t,this.y/=t,this}dived(t){return new Vector2(this.x/t,this.y/t)}minimum(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this}maximum(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this}clamp(t,e){return this.x=Math.max(t.x,Math.min(e.x,this.x)),this.y=Math.max(t.y,Math.min(e.y,this.y)),this}clampScalar(t,e){return this.x=Math.max(t,Math.min(e,this.x)),this.y=Math.max(t,Math.min(e,this.y)),this}clampLength(t,e){const r=this.length();return this.div(r||1).scale(Math.max(t,Math.min(e,r)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}rounded(){return Vector2.new(Math.round(this.x),Math.round(this.y))}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(t){return this.x*t.x+this.y*t.y}cross(t){return this.x*t.y-this.y*t.x}squareSum(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.lengthSquared())}lengthSquared(){return this.x*this.x+this.y*this.y}manhat(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.div(this.length()||1)}normalized(){return this.dived(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}disTo(t){return Math.sqrt(this.disToSquared(t))}disToSquared(t){let e=this.x-t.x,r=this.y-t.y;return e*e+r*r}disToManhat(t){return Math.abs(this.x-t.x)+Math.abs(this.y-t.y)}setLength(t){return this.normalize().scale(t)}lerp(t,e){return new Vector2(this.x+(t.x-this.x)*e,this.y+(t.y-this.y)*e)}sign(t,e){return(this.x-e.x)*(t.y-e.y)-(t.x-e.x)*(this.y-e.y)}projectOnVector(t){const e=t.lengthSquared();if(0===e)return this.set(0,0);const r=t.dot(this)/e;return this.copy(t).scale(r)}}e.Vector2=Vector2},1495:(t,e,r)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.Graph=void 0;const i=r(8299),s=r(5739),o=r(6583),n=r(4013),a=r(5652),h=r(2914);class Graph{constructor(){this.verts=[],this.edges=[]}static new(){return new Graph}static fromMesh(t){let e=Graph.new(),r=t.calculateVertexNormals();t.verts.forEach(((t,i)=>{e.addVert(t,r[i])}));let s=t.getType();if(s==h.MeshType.Invalid||s==h.MeshType.Points)return e;new i.HashTable;let o=t.links._width;return t.links.forEachRow(((t,r)=>{for(let r=0;r<o;r++){let i=(r+1)%o,s=t[r],n=t[i];-1!=s&&-1!=n&&e.addEdgeIfNew(s,n)}})),e}clone(){throw new Error("not yet implemented...")}transform(t){for(let e=0;e<this.verts.length;e++){let r=this.verts[e];r.pos=t.multiplyVector(r.pos)}}print(){console.log("graph"),console.log("--------"),console.log(`${this.verts.length} verts: `);for(let t=0;t<this.verts.length;t++){let e=this.verts[t];console.log(`v(${t}) | edge: ${e.edge}, data: ${e.pos.toString()} normal: ${e.normal.toString()}`)}console.log("--------"),console.log(`${this.edges.length} edges:  `);for(let t=0;t<this.edges.length;t++){let e=this.edges[t];console.log(`e(${t}) | vert: ${e.vert}, twin: ${e.twin}, next: ${e.next}, dead ${e.dead}`)}console.log("--------")}toMesh(){return a.Mesh.fromGraph(this)}toLines(){return a.Mesh.newLines(this.allVertPositions(),this.allUniqueEdgeVerts())}toShaderMesh(){return h.ShaderMesh.fromGraph(this)}allNorms(){let t=[];return this.verts.forEach((e=>{t.push(e.normal)})),t}allVertPositions(){let t=[];return this.verts.forEach((e=>{t.push(e.pos)})),t}allUniqueEdges(){let t=[],e=this.edges.length/2;for(let r=0;r<e;r++){let e=2*r,i=2*r+1,s=this.getEdge(e),o=this.getEdge(i);s.dead||o.dead||t.push(e)}return t}allUniqueEdgeVerts(){let t=[],e=this.edges.length/2;for(let r=0;r<e;r++){let e=2*r,i=2*r+1,s=this.getEdge(e),o=this.getEdge(i);s.dead||o.dead||t.push(s.vert,o.vert)}return t}allEdgeVerts(){let t=[];return this.edges.forEach(((e,r)=>{if(e.dead)return;let i=e.vert,s=this.getEdge(e.twin).vert;i<s&&(t.push(i),t.push(s))})),t}allVertLoops(){throw"TODO"}allVertLoopsAsInts(){let t=[],e=new Set;this.edges.forEach(((t,r)=>{t.dead||e.add(r)}));let r=0;const i=this.edges.length;for(;e.size>0;){let s=[],o=e.entries().next().value[0],n=o;do{if(r>i)throw"topology is corrupt!";r+=1;let t=this.getEdge(o);e.delete(o),s.push(t.vert),o=t.next}while(o!=n);t.push(s)}return t}getLoop(t){let e=[],r=0;const i=this.edges.length;let s=t;do{if(r>i)throw"topology is corrupt!";r+=1;let s=this.getEdge(t);e.push(t),t=s.next}while(t!=s);return e}getVertexPos(t){if(t<0||t>=this.verts.length)throw"out of range";return this.verts[t].pos}getVertexNormal(t){if(t<0||t>=this.verts.length)throw"out of range";return this.verts[t].normal}getVertexCount(){return this.verts.length}getHalfEdgeCount(){return this.edges.length}changeVertex(t,e,r){let i=this.verts[t];i.pos=e,i.normal=r}getVert(t){if(t<0||t>=this.verts.length)throw"out of range";return this.verts[t]}getEdge(t){return(t<0||t>=this.edges.length)&&console.error("out of range"),this.edges[t]}getEdgeIndexBetween(t,e){let r=this.getEdgeBetween(t,e);if(r)return this.getEdgeIndex(r)}getEdgeBetween(t,e){let r=this.getVertEdgeFan(t);for(let t=0;t<r.length;t++)if(this.getEdge(r[t].twin).vert==e)return r[t]}getVertEdgeFan(t){let e=[],r=this.verts[t].edge,i=r;if(-1==r)return e;let s=0;for(;;){if(s>this.verts.length)throw this.print(),console.log("fan: ",e),"nope";s+=1;let t=this.getEdge(r),o=this.getEdgeTwin(r);if(e.push(t),r=o.next,r==i)break}return e}getLoopsAdjacentToEdge(t){let e=[];return e.push(this.getLoop(t)),e.push(this.getLoop(this.getEdge(t).twin)),e}getVertNeighbors(t){let e=[];return this.getVertEdgeFan(t).forEach((t=>{e.push(this.getEdge(t.twin).vert)})),e}getEdgeIndex(t){return this.getEdge(t.twin).twin}getEdgeTwin(t){return this.edges[this.edges[t].twin]}hasEdge(t,e){return this.getVertNeighbors(t).includes(e)}addVert(t,e){return this.verts.push({pos:t,edge:-1,normal:e,dead:!1}),this.verts.length-1}removeVert(t){throw"TODO FIGURE OUT NULL & REMOVAL"}addEdgeIfNew(t,e){return!this.hasEdge(t,e)&&(this.addEdge(t,e),!0)}addEdge(t,e){let r=this.edges.length,i=r+1;this.edges.push({next:-1,twin:i,vert:t,dead:!1}),this.edges.push({next:-1,twin:r,vert:e,dead:!1}),this.addEdgeToDisk(t,r),this.addEdgeToDisk(e,i)}deleteEdgeByIndex(t){this.deleteEdge(this.getEdge(t))}deleteEdge(t){let e=this.getEdge(t.twin);t.dead=!0,e.dead=!0,this.deleteEdgeFromDisk(t),this.deleteEdgeFromDisk(e)}getDiskPositions(t){let e=this.getEdge(t),r=this.getVert(e.vert),i=this.getEdgeTwin(t),o=this.verts[i.vert],a=r.pos.subbed(o.pos),h=[];h.push(a);let l=this.getVertEdgeFan(e.vert),u=[];for(let e=0;e<l.length;e++){let r=l[e];this.getEdgeIndex(r)==t||u.push(r)}if(0==u.length)return[t,t];if(1==u.length){let t=u[0];return[this.getEdgeIndex(t),this.getEdgeIndex(t)]}for(let t=0;t<u.length;t++){let e=u[t],i=this.getEdge(e.twin),s=this.verts[i.vert],o=r.pos.subbed(s.pos);h.push(o)}let c=s.Plane.fromPN(r.pos,r.normal),d=c.ihat,m=c.jhat,f=n.Vector3.calculateWheelOrder(h,d,m),g=-1,p=-1;for(let t=0;t<f.length;t++){let e=(t+1)%f.length,r=(t+2)%f.length;if(0==f[e]){g=f[t],p=f[r];break}}let w=u[p-1],x=u[g-1];return[this.getEdgeIndex(w),this.getEdgeIndex(x)]}addEdgeToDisk(t,e){let r=this.getVert(t),i=this.getEdgeTwin(e);if(-1==r.edge)r.edge=e,i.next=e;else{let[t,r]=this.getDiskPositions(e),[s,o]=[this.getEdge(t),this.getEdge(r)];this.getEdge(s.twin).next=e,i.next=this.getEdgeIndex(o)}}deleteEdgeFromDisk(t){let e=this.getEdgeIndex(t),r=this.getVert(t.vert),[i,s]=this.getDiskPositions(e);if(i==e)return void(r.edge=-1);let[o,n]=[this.getEdge(i),this.getEdge(s)];this.getEdge(o.twin).next=s,r.edge==e&&(r.edge=s)}splitEdge(t,e,r){let i=this.getEdgeBetween(t,e);if(!i)throw new Error(`No Edge found between ${t} and ${e}`);this.getEdge(i.twin);let s=this.getVert(t),o=this.getVert(e),a=n.Vector3.fromLerp(s.pos,o.pos,r),h=n.Vector3.fromLerp(s.normal,o.normal,r),l=this.addVert(a,h);this.getVert(l);return this.deleteEdge(i),this.addEdge(t,l),this.addEdge(l,e),l}subdivide(){let t=this.allEdgeVerts(),e=this.allVertLoopsAsInts(),r=new i.HashTable,s=t.length/2,o=new Array(s);for(let e=0;e<s;e++){let i=t[2*e],s=t[2*e+1],n=this.splitEdge(i,s,.5);o[e]=n,r.set([i,s],n),r.set([s,i],n)}for(let t=0;t<e.length;t++){let i=e[t],s=new Array(i.length);for(let t=0;t<i.length;t++){let e=(t+1)%i.length,o=i[t],n=i[e];s[t]=r.get([o,n])}for(let t=0;t<i.length;t++){let e=(t+1)%i.length;this.addEdge(s[t],s[e])}}}subdivideQuad(){let t=this.allEdgeVerts(),e=this.allVertLoopsAsInts(),r=new i.HashTable,s=t.length/2;for(let e=0;e<s;e++){let i=t[2*e],s=t[2*e+1],o=this.splitEdge(i,s,.5);r.set([i,s],o),r.set([s,i],o)}for(let t=0;t<e.length;t++){let i=e[t],s=n.Vector3.zero();for(let t=0;t<i.length;t++)s.add(this.getVertexPos(i[t]));s.scale(1/i.length);let o=calcPlanarFaceNormal(i.map((t=>this.getVertexPos(t)))),a=this.addVert(s,o);for(let t=0;t<i.length;t++){let e=(t+1)%i.length,s=i[t],o=i[e],n=r.get([s,o]);this.addEdge(a,n)}}}forEveryEdgeVerts(t){let e=this.allUniqueEdgeVerts(),r=e.length/2;for(let i=0;i<r;i++){let r=this.getVert(e[2*i]),s=this.getVert(e[2*i+1]);t(r.pos,s.pos)}}}function calcPlanarFaceNormal(t){let e=t.length;if(e<3)throw"cannot get face planar with 2 or less edges";n.Vector3.zero();let r=t[1].subbed(t[0]),i=t[2].subbed(t[1]);for(let s=1;s<e;s++){if(Math.abs(r.dot(i))>o.Const.TOLERANCE)return r.cross(i);{let r=(s+1)%e;i=t[(s+2)%e].subbed(t[r])}}throw"get planar face failed..."}e.Graph=Graph},5652:(t,e,r)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.Mesh=void 0;const i=r(4735),s=r(4540);class Mesh{constructor(t,e){this.verts=t,this.links=e}clone(){return new Mesh(this.verts.clone(),this.links.clone())}static new(t,e){return new Mesh(t,e)}static fromLists(t,e){return new Mesh(i.MultiVector3.fromList(t),i.IntMatrix.fromList(e,3))}static newEmpty(t,e,r){return new Mesh(i.MultiVector3.new(t),new i.IntMatrix(e,r))}static newLines(t,e){let r=i.MultiVector3.fromList(t),s=i.IntMatrix.fromList(e,2);return new Mesh(r,s)}static fromBiSurface(t,e=10,r=10){let s=e+1,o=r+1,n=i.MultiVector3.new(s*o),a=new i.IntMatrix(e*r*2,3);for(let i=0;i<s;i++)for(let s=0;s<o;s++){let a=i*o+s;n.set(a,t.pointAt(i/e,s/r))}for(let t=0;t<e;t++)for(let e=0;e<r;e++){let i=2*(t*r+e),n=t*s+e,h=n+o,l=n+1,u=h+1;a.setRow(i,[n,h,u]),a.setRow(i+1,[l,n,u])}return new Mesh(n,a)}static fromTriSurface(t,e=10){let r=e+1,o=i.MultiVector3.new(s.GeonMath.stack(r)),n=new i.IntMatrix(s.GeonMath.stack(r),3);return new Mesh(o,n)}static zero(){return new Mesh(i.MultiVector3.new(0),new i.IntMatrix(0,0))}static fromJoin(t){let e=0,r=0;for(let i of t)e+=i.verts.count,r+=i.links.count();let s=i.MultiVector3.new(e),o=new i.IntMatrix(r,3),n=0,a=0;for(let e of t){for(let t=0;t<e.verts.count;t++)s.set(n+t,e.verts.get(t));for(let t=0;t<e.links.count();t++){let r=e.links.getRow(t);for(let t=0;t<r.length;t++)r[t]=r[t]+n;o.setRow(a+t,r)}n+=e.verts.count,a+=e.links.count()}return new Mesh(s,o)}static fromRect(t){let e=t.getCorners(),r=[];r.push(...quadToTri(o[0]));let s=new i.ShaderMesh(4,0,0,2);return s.mesh.verts.fillFromList(e),s.mesh.links.setData(r),s.setUvs(new Float32Array([0,0,0,1,1,0,1,1])),s}static fromRectangle(t){let e=t.getCorners(),r=[];return r.push(...quadToTri(o[0])),this.fromLists(e,r)}static newQuad(t){let e=[...quadToTri(o[0])];return this.fromLists(t,e)}static newOct(t){let e=[];for(let t of o)e.push(...quadToTri(t));return this.fromLists(t,e)}static fromCube(t){let e=t.getCorners();return Mesh.newOct(e)}static newIcosahedron(t=1){let e=new i.Graph,r=t,s=r*((1+5**.5)/2),addVert=t=>{e.addVert(t,t)};addVert(new i.Vector3(-r,-s,0)),addVert(new i.Vector3(r,-s,0)),addVert(new i.Vector3(-r,s,0)),addVert(new i.Vector3(r,s,0)),addVert(new i.Vector3(0,-r,-s)),addVert(new i.Vector3(0,r,-s)),addVert(new i.Vector3(0,-r,s)),addVert(new i.Vector3(0,r,s)),addVert(new i.Vector3(-s,0,-r)),addVert(new i.Vector3(-s,0,r)),addVert(new i.Vector3(s,0,-r)),addVert(new i.Vector3(s,0,r));let addEdge=(t,r)=>{e.addEdge(t,r)};for(let t=0;t<12;t+=4){addEdge(t+0,t+1),addEdge(t+2,t+3);let e=(t+4)%12;addEdge(t+0,e+2),addEdge(t+0,e+0),addEdge(t+1,e+2),addEdge(t+1,e+0),addEdge(t+2,e+3),addEdge(t+2,e+1),addEdge(t+3,e+3),addEdge(t+3,e+1)}return this.fromGraph(e)}static newSphere(t,e,r,s){let o=r*s+2,n=i.MultiVector3.new(o),setVert=function(r,i){n.set(r,i.scale(e).add(t))};setVert(0,new i.Vector3(0,0,1));for(let t=0;t<r;t++)for(let e=0;e<s;e++){let o=Math.PI*(t+1)/(r+1),n=2*Math.PI*e/s,a=Math.sin(o)*Math.cos(n),h=Math.sin(o)*Math.sin(n),l=Math.cos(o);setVert(1+t*s+e,new i.Vector3(a,h,l))}setVert(o-1,new i.Vector3(0,0,-1));let a=s*r*2,h=new i.IntMatrix(a,3);h.fill(-1);let setFace=function(t,e){h.setRow(t,e)};for(let t=0;t<s;t++)setFace(t,[0,t+1,(t+1)%s+1]);for(let t=0;t<r-1;t++){let e=s*t+1,r=e+s;for(let i=0;i<s;i++){let o=e+(i+1)%s,n=r+i,a=r+(i+1)%s,h=s+s*t*2+2*i;setFace(h,[e+i,n,o]),setFace(h+1,[n,a,o])}}for(let t=0;t<s;t++){let e=o-s-1;setFace(a-s+t,[o-1,e+(t+1)%s,e+t])}return new Mesh(n,h)}static newCylinder(t,e,r,s){let o=e.subbed(t),n=2*s+2,a=2*(n-2),h=i.MultiVector3.new(n),setVert=function(t,e){h.set(t,e)},l=i.Plane.fromPN(t,o),u=i.Plane.fromPN(e,o);setVert(0,t);for(let t=0;t<s;t++){let e=new i.Vector3(Math.cos(2*Math.PI*t/s),Math.sin(2*Math.PI*t/s),0).scale(r);e=l.matrix.multiplyVector(e),setVert(t+1,e)}let c=n/2;for(let t=0;t<s;t++){let e=new i.Vector3(Math.cos(2*Math.PI*t/s),Math.sin(2*Math.PI*t/s),0).scale(r);e=u.matrix.multiplyVector(e),setVert(c+t,e)}setVert(n-1,e);let d=new i.IntMatrix(a,3);d.fill(-1);let setFace=function(t,e){d.setRow(t,e)};for(let t=0;t<s;t++){let e=1+t,r=1+(t+1)%s,i=n-1,o=c+t,a=c+(t+1)%s;setFace(4*t,[0,r,e]),setFace(4*t+1,[e,r,o]),setFace(4*t+2,[r,a,o]),setFace(4*t+3,[i,o,a])}return new Mesh(h,d)}static newCone(t,e,r,s){let o=s+2,n=2*s,a=i.MultiVector3.new(o),setVert=function(e,r){a.set(e,r.add(t))},h=new i.IntMatrix(n,3);h.fill(-1);let setFace=function(t,e){h.setRow(t,e)};setVert(0,new i.Vector3(0,0,0));for(let t=0;t<s;t++)setVert(t+1,new i.Vector3(Math.cos(2*Math.PI*t/s),Math.sin(2*Math.PI*t/s),0).scale(e));setVert(o-1,new i.Vector3(0,0,r));for(let t=0;t<s;t++){let e=o-1,r=1+t,i=1+(t+1)%s;setFace(2*t,[0,i,r]),setFace(2*t+1,[r,i,e])}return new Mesh(a,h)}static fromGraph(t){let e=i.MultiVector3.fromList(t.allVertPositions()),r=t.allVertLoopsAsInts(),s=new i.IntMatrix(r.length,3);return r.forEach(((t,e)=>{3==t.length?s.setRow(e,t):console.log("cant convert loop")})),Mesh.new(e,s)}toLines(){const getLines=t=>{let e=this.links.count()*t,r=new i.IntMatrix(e,2);for(let e=0;e<this.links.count();e++)for(let i=0;i<t;i++){let s=(i+1)%t,o=e*t+i;r.set(o,0,this.links.get(e,i)),r.set(o,1,this.links.get(e,s))}return r};let t=this.getType();if(t==i.MeshType.Lines)return this.clone();if(t==i.MeshType.Triangles){let t=getLines(3);return Mesh.new(this.verts.clone(),t)}if(t==i.MeshType.Quads){let t=getLines(4);return Mesh.new(this.verts.clone(),t)}return console.warn("cannot convert to lines"),Mesh.newEmpty(0,0,0)}ToShaderMesh(){return i.ShaderMesh.fromMesh(this)}toGraph(){return i.Graph.fromMesh(this)}getType(){return this.links._width==i.MeshType.Points?i.MeshType.Points:this.links._width==i.MeshType.Lines?i.MeshType.Lines:this.links._width==i.MeshType.Triangles?i.MeshType.Triangles:this.links._width==i.MeshType.Quads?i.MeshType.Quads:i.MeshType.Invalid}getLinkVerts(t){let e=i.MultiVector3.new(this.links._width);return this.links.getRow(t).forEach(((t,r)=>{e.set(r,this.verts.get(t))})),e}calculateFaceNormals(){let t=[];if(this.getType()!=i.MeshType.Triangles)return console.error("can only calculate normals from triangular meshes"),t;let e=this.links.count();for(let r=0;r<e;r++){let e=this.getLinkVerts(r).toList(),i=e[1].subbed(e[0]).cross(e[2].subbed(e[0])).normalize();t.push(i)}return t}calculateVertexNormals(){let t=this.links.count(),e=this.calculateFaceNormals(),r=i.MultiVector3.new(this.verts.count);for(let i=0;i<t;i++){let t=e[i];this.links.getRow(i).forEach((e=>{let i=r.get(e);r.set(e,i.add(t))}))}let s=r.toList();for(let t=0;t<s.length;t++)s[t].normalize();return s}}e.Mesh=Mesh;const o=[[0,1,3,2],[4,0,2,6],[1,0,4,5],[1,5,7,3],[2,3,7,6],[5,4,6,7]];function quadToTri(t){return[t[0],t[2],t[1],t[0],t[3],t[2]]}},6652:(t,e,r)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.getDefaultIndices=e.MultiLine=void 0;const i=r(4735);class MultiLine{constructor(t,e){this.verts=i.ToFloatMatrix(t),this.links=null==e?getDefaultIndices(this.verts.height):e}static fromLines(t){let e=i.ToFloatMatrix(t);return new MultiLine(e)}static fromMesh(t,e=!1){let r=t.mesh,i=6*r.links.count(),s=new Uint16Array(i);for(let t=0;t<r.links.count();t++){let e=6*t;s[e]=r.links.get(t,0),s[e+1]=r.links.get(t,1),s[e+2]=r.links.get(t,1),s[e+3]=r.links.get(t,2),s[e+4]=r.links.get(t,2),s[e+5]=r.links.get(t,0)}return new MultiLine(e?t.uvs.toMatrixSlice():r.verts.slice(),s)}static fromGrid(t,e,r){let s=(e-1)*r/2,o=i.MultiVector3.new(4*e);for(let t=0;t<e;t++){let e=r*t-s;o.set(2*t,new i.Vector3(e,-s,0)),o.set(2*t+1,new i.Vector3(e,s,0))}for(let t=0;t<e;t++){o.set(2*e+2*t,new i.Vector3(-s,r*t-s,0)),o.set(2*e+2*t+1,new i.Vector3(s,r*t-s,0))}return o.forEach((e=>t.pushToWorld(e))),new MultiLine(o.slice())}static fromPlane(t){let e=i.Const.PLANE_RENDER_LINECOUNT,r=i.Const.PLANE_RENDER_LINEDISTANCE,s=r/10,o=(e-1)*r/2,n=i.MultiVector3.new(4*e+10);for(let t=0;t<e;t++){let e=r*t-o;n.set(2*t,new i.Vector3(e,-o,0)),n.set(2*t+1,new i.Vector3(e,o,0))}for(let t=0;t<e;t++){n.set(2*e+2*t,new i.Vector3(-o,r*t-o,0)),n.set(2*e+2*t+1,new i.Vector3(o,r*t-o,0))}let a=n.count-10;n.set(a,new i.Vector3(o+s,-s,0)),n.set(a+1,new i.Vector3(o+4*s,s,0));let h=n.count-8;n.set(h,new i.Vector3(o+s,s,0)),n.set(h+1,new i.Vector3(o+4*s,-s,0));let l=n.count-6;n.set(l,new i.Vector3(0,o+2.5*s,0)),n.set(l+1,new i.Vector3(s,o+4*s,0));let u=n.count-4;n.set(u,new i.Vector3(s,o+s,0)),n.set(u+1,new i.Vector3(-s,o+4*s,0));let c=n.count-2;return n.set(c,new i.Vector3(0,0,0)),n.set(c+1,new i.Vector3(0,0,r)),n.forEach((e=>t.pushToWorld(e))),new MultiLine(n.slice())}static fromCircle(t,e=i.Const.CIRCLE_SEGMENTS){let r=e,s=i.MultiVector3.new(r);for(let e=0;e<r;e++){let o=e/r*(2*Math.PI);s.set(e,t.plane.pushToWorld(new i.Vector3(Math.cos(o)*t.radius,Math.sin(o)*t.radius,0)))}return new MultiLine(s.slice(),getPairIndices(r,!0))}static fromPolyline(t){return new MultiLine(t.verts,getPairIndices(t.verts.count,!1))}static fromBezier(t,e=i.Const.BEZIER_SEGMENTS){let r=e+1,s=i.MultiVector3.new(r);for(let i=0;i<r;i++){let r=i/e;s.set(i,t.pointAt(r))}return new MultiLine(s.slice(),getPairIndices(r,!1))}static fromCube(t){let e=i.MultiVector3.fromList(t.getCorners());return new MultiLine(e)}static fromJoin(t){let e=0,r=0;for(let i of t)e+=i.links.length,r+=i.verts.count();let s=i.MultiVector3.new(r),o=new Uint16Array(e),n=0,a=0;for(let e of t){for(let t=0;t<e.verts.count();t++)s.slice().setRow(n+t,e.verts.getRow(t));for(let t=0;t<e.links.length;t++)o[a+t]=e.links[t]+n;n+=e.verts.count(),a+=e.links.length}return new MultiLine(s,o)}}function getDefaultIndices(t){let e=new Uint16Array(t);for(let r=0;r<t;r++)e[r]=r;return e}function getPairIndices(t,e){let r=2*t;e||(r-=2);let i=new Uint16Array(r);for(let e=0;e<t;e++)i[2*e]=e,i[2*e+1]=(e+1)%t;return i}e.MultiLine=MultiLine,e.getDefaultIndices=getDefaultIndices},2914:(t,e,r)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.meshFromObj=e.ShaderMesh=e.NormalKind=e.MeshType=void 0;const i=r(4735);var s,o;!function(t){t[t.Invalid=0]="Invalid",t[t.Points=1]="Points",t[t.Lines=2]="Lines",t[t.Triangles=3]="Triangles",t[t.Quads=4]="Quads"}(s=e.MeshType||(e.MeshType={})),function(t){t[t.None=0]="None",t[t.Vertex=1]="Vertex",t[t.Face=2]="Face",t[t.MultiVertex=3]="MultiVertex"}(o=e.NormalKind||(e.NormalKind={}));class ShaderMesh{constructor(t,e,r,s,n){this._normKind=o.None,this.color=[1,1,1,1],this.linecolor=[1,1,1,1];this.mesh=i.Mesh.newEmpty(t,s,3),this.norms=i.MultiVector3.new(e),this.uvs=i.MultiVector2.new(r),this.ambi=new Float32Array(t),this.texture=n,this.position=i.Matrix4.newIdentity()}static new(t,e,r,i,s){return new ShaderMesh(t,e,r,i,s)}static fromMesh(t){let e=new ShaderMesh(t.verts.count,0,0,t.links.count());return e.mesh=t,e}static fromData(t,e,r,s){let o=new ShaderMesh(t.length/3,e.length/3,r.length/2,s.length/3);return o.mesh.verts.slice().fillWith(t),o.mesh.links.fillWith(s),o.norms.slice().fillWith(e),o.uvs=i.MultiVector2.fromData(r),o}static fromGraph(t){let e=t.toMesh(),r=ShaderMesh.fromMesh(e);return r.norms=i.MultiVector3.fromList(t.allNorms()),r._normKind=o.Vertex,r}transform(t){for(let e=0;e<this.mesh.verts.count;e++){let r=this.mesh.verts.get(e),i=this.norms.get(e);this.mesh.verts.set(e,t.multiplyVector(r)),this.norms.set(e,t.multiplyVector(i))}}getAdjacentFaces(t){let e=[],r=this.mesh.links.count();for(let i=0;i<r;i++)this.mesh.links.getRow(i).find((e=>e==t))&&e.push(i);return e}getFaceVertices(t){return this.mesh.getLinkVerts(t)}getType(){return this.mesh.getType()}getNormalType(){return this._normKind}setTexture(t){this.texture=t}setUvs(t){t instanceof Float32Array?this.uvs=i.MultiVector2.fromData(t):this.uvs=t}exportToObj(t){throw"todo"}calculateFaceNormals(){if(this.getType()!=s.Triangles)return console.error("can only calculate normals from triangular meshes"),void(this.norms=i.MultiVector3.new(0));let t=this.mesh.calculateFaceNormals();this.norms=i.MultiVector3.fromList(t),this._normKind=o.Face}calculateVertexNormals(){let t=this.mesh.calculateVertexNormals();this.norms=i.MultiVector3.fromList(t),this._normKind=o.Vertex}calculateMultiVertexNormals(){this._normKind=o.MultiVertex,this.calculateFaceNormals();let t=this.mesh.verts.map(((e,r)=>{let i=this.getAdjacentFaces(r);t.set(r,this.norms.take(i).average())}));this.norms=t}}function ProcessObjFaceVertex(t){let e=[],r=t.split("/");if(1==r.length)e.push(parseInt(r[0])-1);else{if(3!=r.length)throw"invalid face found when processing";e.push(parseInt(r[0])-1)}return e}function ProcessObjFace(t){let e=[];if(4==t.length){let r=ProcessObjFaceVertex(t[0]),i=ProcessObjFaceVertex(t[1]),s=ProcessObjFaceVertex(t[2]),o=ProcessObjFaceVertex(t[3]);e.push(...r,...i,...s,...r,...s,...o)}else if(3==t.length){let r=ProcessObjFaceVertex(t[0]),i=ProcessObjFaceVertex(t[1]),s=ProcessObjFaceVertex(t[2]);e.push(...r,...i,...s)}return e}e.ShaderMesh=ShaderMesh,e.meshFromObj=function meshFromObj(t){let e=[],r=[],i=[],s=[];const o=/(\w*)(?: )*(.*)/,n=t.split("\n");for(let t=0;t<n.length;++t){const a=n[t].trim();if(""===a||a.startsWith("#"))continue;const h=o.exec(a);if(!h)continue;const[,l,u]=h,c=a.split(/\s+/).slice(1);switch(l){case"v":for(const t of c)e.push(parseFloat(t));break;case"vn":for(const t of c)r.push(parseFloat(t));break;case"vt":for(const t of c)i.push(parseFloat(t));break;case"f":for(const t of ProcessObjFace(c))s.push(t);break;default:console.warn("unhandled keyword:",l);continue}}return ShaderMesh.fromData(e,r,i,s)}},6829:(t,e,r)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.TopoMesh=void 0;const i=r(4735);class TopoMesh extends i.ShaderMesh{constructor(t,e,r,s,o){super(t,e,r,s,o),this.lastTouched=0,this.neighborMap=new i.IntMatrix(this.mesh.links.count(),3)}static copyFromShaderMesh(t){let e=new TopoMesh(t.mesh.verts.count,t.norms.count,t.uvs.count,t.mesh.links.count());return e.mesh.verts=t.mesh.verts.clone(),e.norms=t.norms.clone(),e.uvs=t.uvs.clone(),e.mesh.links=t.mesh.links.clone(),e.setNeighborMap(),e}setNeighborMap(){let t=new i.HashTable,e=new i.HashTable;this.mesh.links.forEachRow(((r,i)=>{[[r[0],r[1]],[r[1],r[2]],[r[2],r[0]]].forEach((r=>{let s=r[0]>r[1],o=new Int32Array([Math.min(...r),Math.max(...r)]);if(t.has(o)){let r=t.get(o),n=r[0],a=r[1];r[2]=i,t.set(o,r),this.setNb(i,o,a),this.setNb(a,o,i);let h=[a,i];h.sort(),s!=n?e.set(h,!1):e.set(h,!0)}else t.set(o,[s,i,-1])}))}));console.log("number of 'wrong' face neighbours: ",0)}walkUV(t){let e=this.lastTouched,r=this.mesh.links.count();for(let i=0;i<r;i++){if(-1==e)return-1;for(let r=0;r<3;r++){let i=(r+1)%3,s=this.mesh.links.getRow(e),o=[s[r],s[i]],n=this.uvs.get(o[0]),a=this.uvs.get(o[1]);if(t.sign(n,a)<0){if(e=this.getNb(e,o),-1==e)return-1;this.lastTouched=e;break}if(2==r)return e}}return-1}closestFaces(t){let e=this.mesh.verts.closestId(t),r=[];return this.mesh.links.forEachRow(((t,i)=>{t.includes(e)&&r.push(i)})),r}elevate(t){let e=this.walkUV(t);if(-1==e)return console.warn("got a point not on triangle..."),new i.Vector3(0,0,0);let r=this.getTriangle3(e),s=this.getTriangle2(e).toBarycentric(t);return r.fromBarycentric(s)}closestFace(t){let e=this.closestFaces(t),r=i.MultiVector3.new(e.length);return e.forEach(((e,i)=>{let s=this.getTriangle3(e).closestPoint(t);r.set(i,s)})),e[r.closestId(t)]}flatten(t,e){let r=this.getTriangle3(e),i=this.getTriangle2(e),s=r.toBarycentric(t);return i.fromBarycentric(s)}flattenClosestPoint(t){let e=this.closestFace(t);return this.flatten(t,e)}closestPoint(t){let e=this.closestFace(t),r=this.getTriangle3(e),i=r.toBarycentric(t);return r.fromBarycentric(i)}getTriangle2(t){let e=this.getFacePoints(t,!0);return new i.Triangle2(e[0],e[1],e[2])}getTriangle3(t){let e=this.getFacePoints(t,!1);return new i.Triangle3(e[0],e[1],e[2])}setNb(t,e,r){for(let i=0;i<3;i++)if(!e.includes(this.mesh.links.get(t,i)))return void this.neighborMap.set(t,i,r);throw console.log(this.mesh.links.getRow(t)),console.log(e),"these are not actually neighbors!"}getNb(t,e){for(let r=0;r<3;r++)if(!e.includes(this.mesh.links.get(t,r)))return this.neighborMap.get(t,r);throw console.log(this.mesh.links.getRow(t)),console.log(e),"common edge does not match triangle index!"}getFacePoints(t,e){let r=this.mesh.links.getRow(t);return e?[this.uvs.get(r[0]),this.uvs.get(r[1]),this.uvs.get(r[2])]:[this.mesh.verts.get(r[0]),this.mesh.verts.get(r[1]),this.mesh.verts.get(r[2])]}}e.TopoMesh=TopoMesh},5435:(t,e,r)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.Camera=void 0;const i=r(5739),s=r(4540),o=r(9907),n=r(7603),a=r(4013);class Camera{constructor(t,e=1,r=!1,s=!0){this.angleAlpha=0,this.angleBeta=0,this.mousePos=a.Vector2.zero(),this.fov=20*Math.PI/100,this.zFar=1e4,this.zNear=.01,this.speed=1,this.worldPlane=i.Plane.WorldXY(),this.canMove=r,this.canControl=s,this.pos=new a.Vector3(0,0,0),this.z_offset=-e,this.offset=new a.Vector3(0,0,-e),this.updateMatrices(t)}new(t,e=1,r=!1){return new Camera(t,e,r)}update(t){this.updateControls(t),this.updateMatrices(t.canvas),this.updateClick(t),t.IsKeyPressed("p")&&(console.log(`camera state: [${this.pos.x.toPrecision(5)}, ${this.pos.y.toPrecision(5)}, ${this.pos.z.toPrecision(5)}, ${this.z_offset}, ${this.angleAlpha},${this.angleBeta}]`),console.log("speed is now: "+this.speed))}getState(){return[this.pos.x,this.pos.y,this.pos.z,this.z_offset,this.angleAlpha,this.angleBeta]}setState(t){this.pos.x=t[0],this.pos.y=t[1],this.pos.z=t[2],this.z_offset=t[3],this.angleAlpha=t[4],this.angleBeta=t[5]}set(t,e,r){this.z_offset=t,this.angleAlpha=e,this.angleBeta=r}updateMatrices(t){this.worldMatrix=this.getWorldMatrix(),this.projectMatrix=this.getProjectionMatrix(t),this.totalMatrix=this.worldMatrix.multiplied(this.projectMatrix)}lookat(t,e){o.Matrix4.newLookAt(t,e,this.worldPlane.khat)}updateClick(t){}updateControls(t){if(!this.canControl)return;let e=1.2*t.scrollValue;this.offset.z=Math.min(-.001,this.z_offset-e),t.IsKeyPressed("shift")&&(this.speed*=2),t.IsKeyPressed("control")&&(this.speed=Math.max(.5*this.speed,.1));let r=this.mousePos.clone();this.mousePos=t.mousePos.clone();let i=r.clone().sub(this.mousePos);function relativeUnitY(t){return o.Matrix4.newZRotation(t).multiplyVector(a.Vector3.unitY())}function relativeUnitX(t){return o.Matrix4.newZRotation(t).multiplyVector(a.Vector3.unitX())}this.getMouseWorldRay(t.canvas.width,t.canvas.height),t.mouseRightDown&&(this.angleAlpha=s.GeonMath.clamp(this.angleAlpha+.01*i.y,0,Math.PI),this.angleBeta+=-.01*i.x),this.canMove&&(t.IsKeyDown("s")&&this.pos.add(relativeUnitY(-this.angleBeta).scale(.01*this.speed)),t.IsKeyDown("w")&&this.pos.add(relativeUnitY(-this.angleBeta).scale(-.01*this.speed)),t.IsKeyDown("a")&&this.pos.add(relativeUnitX(-this.angleBeta).scale(.01*this.speed)),t.IsKeyDown("d")&&this.pos.add(relativeUnitX(-this.angleBeta).scale(-.01*this.speed)),t.IsKeyDown("q")&&(this.pos.z+=.01*this.speed),t.IsKeyDown("e")&&(this.pos.z-=.01*this.speed))}getCameraPoint(){return this.worldMatrix.inverse().multiplyVector(new a.Vector3(0,0,0))}getMouseWorldRay(t,e,r=!0){let i=this.mousePos,s=t/e,o=(i.x/t-.5)*s,h=i.y/e-.5,l=.5/Math.tan(this.fov/2),u=this.worldMatrix.inverse(),c=u.multiplyVector(new a.Vector3(0,0,0)),d=u.multiplyVector(new a.Vector3(1,0,0)),m=u.multiplyVector(new a.Vector3(0,1,0)),f=u.multiplyVector(new a.Vector3(0,0,-1)),g=d.sub(c).normalize(),p=m.sub(c).normalize(),w=f.sub(c).normalize(),x=r?c.added(w.scaled(l)).add(g.scaled(o)).add(p.scaled(-h)):c.added(w.scaled(l));return n.Ray.fromPoints(c,x)}getWorldMatrix(){let t=this.offset,e=this.angleAlpha,r=this.angleBeta,i=(new o.Matrix4([1,0,0,0,0,0,1,0,0,1,0,0,0,0,0,1]),o.Matrix4.newTranslation(this.pos.x,this.pos.y,this.pos.z)),s=o.Matrix4.newTranslation(t.x,t.y,t.z),n=o.Matrix4.newXRotation(e),a=o.Matrix4.newZRotation(r).multiply(n);return i.multiply(a).multiply(s)}getProjectionMatrix(t){let e=t.width/t.height;return o.Matrix4.newPerspective(this.fov,e,this.zNear,this.zFar)}}e.Camera=Camera},2984:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.Context=void 0;e.Context=class Context{constructor(t){this.camera=t}}},3747:(t,e,r)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.Light=void 0;const i=r(4013);class Light{constructor(t,e,r,i){this.pos=t,this.color=e,this.spot=r,this.dir=i}static new(t,e=[1,1,1,1]){return new Light(t,e,!1,i.Vector3.zero())}}e.Light=Light},2561:(t,e,r)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.MultiShader=void 0;const i=r(4735);e.MultiShader=class MultiShader{setAndRender(t,e){this.set(t,i.DrawSpeed.DynamicDraw),this.render(e)}}},8390:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.Shader=e.DrawSpeed=void 0;var r,i=0;!function(t){t[t.StaticDraw=0]="StaticDraw",t[t.DynamicDraw=1]="DynamicDraw"}(r=e.DrawSpeed||(e.DrawSpeed={}));class Shader{constructor(t,e,r){this.gl=t,this.program=Shader.createProgramFromScripts(t,e,r)}setAndRender(t,e){this.set(t,r.DynamicDraw),this.render(e)}static getNextTextureID(){let t=i;return i+=1,t}static resizeCanvas(t){let e=t.canvas;const r=e.clientWidth,i=e.clientHeight,s=t.canvas.width!==r||t.canvas.height!==i;return s&&(t.canvas.width=r,t.canvas.height=i),t.viewport(0,0,t.canvas.width,t.canvas.height),s}convertDrawSpeed(t){return t==r.DynamicDraw?this.gl.DYNAMIC_DRAW:this.gl.STATIC_DRAW}static initWebglContext(t,e=!1){let r=t.getContext("webgl");null==r&&console.log("webgl unavailable...");let i=r;return i.enable(i.CULL_FACE),e?(i.enable(i.BLEND),i.disable(i.DEPTH_TEST),i.blendFunc(i.SRC_ALPHA,i.ONE_MINUS_SRC_ALPHA)):(i.disable(i.BLEND),i.enable(i.DEPTH_TEST),i.depthFunc(i.LEQUAL)),i.clearColor(0,0,0,1),i.clearDepth(1),i}static compileShader(t,e,r){let i=t.createShader(r);if(t.shaderSource(i,e),t.compileShader(i),!t.getShaderParameter(i,t.COMPILE_STATUS))throw"could not compile shader:"+e+t.getShaderInfoLog(i);return i}static createProgram(t,e,r){let i=t.createProgram();if(t.attachShader(i,e),t.attachShader(i,r),t.linkProgram(i),!t.getProgramParameter(i,t.LINK_STATUS))throw"program failed to link:"+t.getProgramInfoLog(i);return i}static createProgramFromScripts(t,e,r){let i=Shader.compileShader(t,e,t.VERTEX_SHADER),s=Shader.compileShader(t,r,t.FRAGMENT_SHADER);return Shader.createProgram(t,i,s)}}e.Shader=Shader},7356:(t,e,r)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.DotShader2=void 0;const i=r(8390);class DotShader2 extends i.Shader{constructor(t,e=5,r=[1,1,1,1],i=!0){let s="\n        attribute vec2 a_position;\n        \n        uniform vec2 u_resolution;\n        uniform float u_size;\n\n        void main() {\n            vec2 clipped = ((a_position / u_resolution) * 2.0) - 1.0;\n      \n            gl_PointSize = u_size;\n            gl_Position = vec4(clipped, 0, 1);\n            // gl_Position = vec4(0,0,0,1);\n        }\n        ";super(t,s,i?"\n        precision mediump int;\n        precision mediump float;\n\n        uniform vec4 u_Color;\n        vec2 center = vec2(0.5, 0.5);\n\n        void main() {\n            gl_FragColor = vec4(1,1,1,1);\n        }\n        ":"\n        precision mediump int;\n        precision mediump float;\n\n        uniform vec4 u_Color;\n        vec2 center = vec2(0.5, 0.5);\n\n        void main() {\n            if (distance(center, gl_PointCoord) > 0.5) {\n               discard;\n            }\n            gl_FragColor = vec4(1,1,1,1);\n        }\n        "),this.u_resolution=t.getUniformLocation(this.program,"u_resolution"),this.u_size=t.getUniformLocation(this.program,"u_size"),this.u_color=t.getUniformLocation(this.program,"u_color"),this.color=r,this.size=e,this.a_position=t.getAttribLocation(this.program,"a_position"),this.a_position_buffer=t.createBuffer(),t.bindBuffer(t.ARRAY_BUFFER,this.a_position_buffer)}set(){}render(t){}setAndRender(t,e){let r=this.gl;r.useProgram(this.program),r.uniform2f(this.u_resolution,r.canvas.width,r.canvas.height),r.uniform1f(this.u_size,this.size),r.uniform4f(this.u_color,this.color[0],this.color[1],this.color[2],this.color[3]),r.enableVertexAttribArray(this.a_position),r.bindBuffer(r.ARRAY_BUFFER,this.a_position_buffer);var i=r.FLOAT,s=0;r.vertexAttribPointer(this.a_position,2,i,!1,0,s);let o=this.toFloat32Array(t);r.bufferData(r.ARRAY_BUFFER,o,r.DYNAMIC_DRAW);var n=r.POINTS,a=(s=0,t.length);r.drawArrays(n,s,a)}toFloat32Array(t){let e=new Float32Array(2*t.length);for(let r=0;r<t.length;r++)e[2*r]=t[r].x,e[2*r+1]=t[r].y;return e}randomInt(t){return Math.floor(Math.random()*t)}}e.DotShader2=DotShader2},2307:(t,e,r)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.DotShader=void 0;const i=r(4735);class DotShader extends i.Shader{constructor(t,e=5,r=[1,1,1,1],i=!0){let s="\n        precision mediump int;\n        precision mediump float;\n\n        uniform mat4 u_transform;\n        uniform vec4 u_color;\n        uniform float u_size;\n\n        attribute vec3 a_vertex;\n\n        void main() {\n            // Set the size of a rendered point.\n            gl_PointSize = u_size;\n\n            // Transform the location of the vertex.\n            gl_Position = u_transform * vec4(a_vertex, 1.0);\n        }\n\n        ";super(t,s,i?"\n        precision mediump int;\n        precision mediump float;\n\n        uniform vec4 u_color;\n        // vec2 center = vec2(0.5, 0.5);\n\n        void main() {\n            gl_FragColor = u_color;\n        }\n        ":"\n        precision mediump int;\n        precision mediump float;\n\n        uniform vec4 u_color;\n        vec2 center = vec2(0.5, 0.5);\n\n        void main() {\n            if (distance(center, gl_PointCoord) > 0.5) {\n               discard;\n            }\n            gl_FragColor = u_color;\n        }\n        "),this.u_transform=t.getUniformLocation(this.program,"u_transform"),this.u_size=t.getUniformLocation(this.program,"u_size"),this.u_color=t.getUniformLocation(this.program,"u_color"),this.color=r,this.size=e,this.count=0,this.a_position=t.getAttribLocation(this.program,"a_vertex"),this.a_position_buffer=t.createBuffer(),t.bindBuffer(t.ARRAY_BUFFER,this.a_position_buffer)}set(t,e=i.DrawSpeed.StaticDraw){let r=this.gl;r.useProgram(this.program);let s=i.ToFloatMatrix(t);this.count=s.count(),r.bindBuffer(r.ARRAY_BUFFER,this.a_position_buffer),r.enableVertexAttribArray(this.a_position),r.vertexAttribPointer(this.a_position,s.width,r.FLOAT,!1,0,0),r.bufferData(r.ARRAY_BUFFER,s.data,super.convertDrawSpeed(e))}render(t){let e=this.gl,r=t.camera.totalMatrix;e.useProgram(this.program),e.uniformMatrix4fv(this.u_transform,!1,r.data),e.uniform1f(this.u_size,this.size),e.uniform4f(this.u_color,this.color[0],this.color[1],this.color[2],this.color[3]),e.bindBuffer(e.ARRAY_BUFFER,this.a_position_buffer),e.enableVertexAttribArray(this.a_position),e.vertexAttribPointer(this.a_position,3,e.FLOAT,!1,0,0),e.drawArrays(e.POINTS,0,this.count)}setAndRender(t,e){this.set(t,i.DrawSpeed.DynamicDraw),this.render(e)}}e.DotShader=DotShader},321:(t,e,r)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.GraphDebugShader=void 0;const i=r(4735),s=r(2561),o=r(2307),n=r(1930),a=r(530),h=r(5557);class GraphDebugShader extends s.MultiShader{constructor(t,e=[1,0,0,.25],r=[1,0,0,1],i=!0){super(),this.faceRend=new h.SimpleMeshShader(t,e),this.lineRend=new n.LineShader(t,r),this.pointRend=new o.DotShader(t,7,r,!1),i&&(this.normRend=new a.NormalShader(t))}set(t,e=i.DrawSpeed.StaticDraw){this.pointRend.set(t.allVertPositions(),e),this.lineRend.set(t.toLines(),e)}render(t){this.pointRend.render(t),this.lineRend.render(t)}setAndRender(t,e){throw new Error("Method not implemented.")}}e.GraphDebugShader=GraphDebugShader},1930:(t,e,r)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.LineShader=void 0;const i=r(4735);class LineShader extends i.Shader{constructor(t,e=[1,1,1,.5]){super(t,"\n        precision mediump int;\n        precision mediump float;\n\n        attribute vec4 a_position;\n        uniform mat4 u_transform;\n        uniform vec4 u_color;\n\n        void main() {\n            gl_Position = u_transform * a_position;\n        }\n        ","\n        precision mediump int;\n        precision mediump float;\n\n        uniform vec4 u_color;\n\n        void main () {\n            gl_FragColor = u_color;\n        }\n        "),this.u_transform=t.getUniformLocation(this.program,"u_transform"),this.u_color=t.getUniformLocation(this.program,"u_color"),this.a_position=t.getAttribLocation(this.program,"a_position"),this.a_position_buffer=t.createBuffer(),this.index_buffer=t.createBuffer(),t.useProgram(this.program),t.uniform4f(this.u_color,e[0],e[1],e[2],e[3]),this.count=0,this.vertCount=0}set(t,e=i.DrawSpeed.StaticDraw,r=i.Matrix4.newIdentity()){let s,o,n=this.gl;t instanceof i.Mesh?(o=t.verts.slice(),s=t.links.getData()):(o=t.verts,s=t.links),n.useProgram(this.program),this.count=s.length,this.vertCount=o.width;let a=this.convertDrawSpeed(e);n.bindBuffer(n.ARRAY_BUFFER,this.a_position_buffer),n.enableVertexAttribArray(this.a_position),n.vertexAttribPointer(this.a_position,this.vertCount,n.FLOAT,!1,0,0),n.bufferData(n.ARRAY_BUFFER,o.data,a),n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,this.index_buffer),n.bufferData(n.ELEMENT_ARRAY_BUFFER,s.buffer,a)}render(t){let e=this.gl,r=t.camera.totalMatrix;e.useProgram(this.program),e.bindBuffer(e.ARRAY_BUFFER,this.a_position_buffer),e.enableVertexAttribArray(this.a_position),e.vertexAttribPointer(this.a_position,this.vertCount,e.FLOAT,!1,0,0),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,this.index_buffer),e.uniformMatrix4fv(this.u_transform,!1,r.data),e.drawElements(e.LINES,this.count,e.UNSIGNED_SHORT,0)}setAndRender(t,e){this.set(t,i.DrawSpeed.DynamicDraw),this.render(e)}}e.LineShader=LineShader},4925:(t,e,r)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.MeshDebugShader=void 0;const i=r(4735),s=r(2561),o=r(1930),n=r(530),a=r(5557);class MeshDebugShader extends s.MultiShader{constructor(t,e=[1,0,0,.25],r=[1,0,0,1],s=!0){super(),this.faceRend=new a.SimpleMeshShader(t,e),this.lineRend=new o.LineShader(t,r),this.personal=i.Matrix4.newIdentity(),s&&(this.normRend=new n.NormalShader(t))}static new(t,e=[1,0,0,.25],r=[1,0,0,1],i=!0){return new MeshDebugShader(t,e,r,i)}set(t,e=i.DrawSpeed.StaticDraw){var r;this.personal=t.position,this.faceRend.set(t.mesh),this.lineRend.set(i.MultiLine.fromMesh(t),e),null===(r=this.normRend)||void 0===r||r.set(t,e)}render(t){var e;this.faceRend.render(t),this.lineRend.render(t),null===(e=this.normRend)||void 0===e||e.render(t)}setAndRender(t,e){this.set(t,i.DrawSpeed.DynamicDraw),this.render(e)}}e.MeshDebugShader=MeshDebugShader},530:(t,e,r)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.NormalShader=void 0;const i=r(4735);class NormalShader extends i.Shader{constructor(t){super(t,"\n        precision mediump int;\n        precision mediump float;\n\n        attribute vec4 a_vertex;\n        attribute vec4 a_vertex_color;\n\n        uniform mat4 u_transform;\n\n        varying vec4 v_color;\n\n        void main() {\n            gl_Position = u_transform * a_vertex;\n            v_color = a_vertex_color;\n        }\n        ","\n        precision mediump int;\n        precision mediump float;\n\n        varying vec4 v_color;\n\n        void main () {\n            gl_FragColor = v_color;\n        }\n        "),this.u_transform=t.getUniformLocation(this.program,"u_transform"),this.a_position=t.getAttribLocation(this.program,"a_vertex"),this.a_color=t.getAttribLocation(this.program,"a_vertex_color"),this.a_position_buffer=t.createBuffer(),this.a_color_buffer=t.createBuffer(),this.index_buffer=t.createBuffer(),t.useProgram(this.program),this.count=0,this.vertCount=0,this.scale=.4}set(t,e=i.DrawSpeed.StaticDraw){let r=this.gl;r.useProgram(this.program);let s,o,n=this.convertDrawSpeed(e);this.vertCount=3;let a=t.getNormalType();if(a==i.NormalKind.Face){let e=t.mesh.links.count();this.count=2*e,s=i.MultiVector3.new(this.count),o=i.MultiVector3.new(this.count);for(let r=0;r<e;r++){let e=t.getFaceVertices(r).average(),n=t.norms.get(r),a=2*r,h=2*r+1;s.set(a,e),s.set(h,e.add(n.scaled(this.scale)));let l=n.add(new i.Vector3(1,1,1).div(2));o.set(a,l),o.set(h,l)}}else{if(a!=i.NormalKind.Vertex)return void(this.count=0);{let e=t.mesh.verts.count;this.count=2*e,s=i.MultiVector3.new(this.count),o=i.MultiVector3.new(this.count);for(let r=0;r<e;r++){let e=t.mesh.verts.get(r),n=t.norms.get(r),a=2*r,h=2*r+1;s.set(a,e),s.set(h,e.add(n.scaled(this.scale)));let l=n.add(new i.Vector3(1,1,1)).div(2);o.set(a,l),o.set(h,l)}}}r.bindBuffer(r.ARRAY_BUFFER,this.a_position_buffer),r.enableVertexAttribArray(this.a_position),r.vertexAttribPointer(this.a_position,this.vertCount,r.FLOAT,!1,0,0),r.bufferData(r.ARRAY_BUFFER,s.slice().data,n),r.bindBuffer(r.ARRAY_BUFFER,this.a_color_buffer),r.enableVertexAttribArray(this.a_color),r.vertexAttribPointer(this.a_color,this.vertCount,r.FLOAT,!1,0,0),r.bufferData(r.ARRAY_BUFFER,o.slice().data,n),r.bindBuffer(r.ELEMENT_ARRAY_BUFFER,this.index_buffer),r.bufferData(r.ELEMENT_ARRAY_BUFFER,i.getDefaultIndices(this.count),n)}render(t){let e=this.gl,r=t.camera.totalMatrix;t.camera;e.useProgram(this.program),e.bindBuffer(e.ARRAY_BUFFER,this.a_position_buffer),e.enableVertexAttribArray(this.a_position),e.vertexAttribPointer(this.a_position,this.vertCount,e.FLOAT,!1,0,0),e.bindBuffer(e.ARRAY_BUFFER,this.a_color_buffer),e.enableVertexAttribArray(this.a_color),e.vertexAttribPointer(this.a_color,this.vertCount,e.FLOAT,!1,0,0),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,this.index_buffer),e.uniformMatrix4fv(this.u_transform,!1,r.data),e.drawElements(e.LINES,this.count,e.UNSIGNED_SHORT,0)}}e.NormalShader=NormalShader},5537:(t,e,r)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.RectangleShader=void 0;const i=r(8390);class RectangleShader extends i.Shader{constructor(t){super(t,"\n        attribute vec2 a_position;\n\n        uniform vec2 u_resolution;\n\n        void main() {\n            // convert the rectangle from pixels to 0.0 to 1.0\n            vec2 zeroToOne = ((a_position / u_resolution) * 2.0) - 1.0;\n\n            // convert from 0->1 to 0->2\n            // vec2 zeroToTwo = zeroToOne * 2.0;\n\n            // convert from 0->2 to -1->+1 (clipspace)\n            // vec2 clipSpace = zeroToTwo - 1.0;\n\n            gl_Position = vec4(zeroToOne * vec2(1, -1), 0, 1);\n        }\n        ","\n        precision mediump float;\n\n        uniform vec4 u_color;\n        \n        void main() {\n           gl_FragColor = u_color;\n        }\n        "),this.a_position=t.getAttribLocation(this.program,"a_position"),this.a_position_buffer=t.createBuffer(),this.u_resolution=t.getUniformLocation(this.program,"u_resolution"),this.u_color=t.getUniformLocation(this.program,"u_color"),t.bindBuffer(t.ARRAY_BUFFER,this.a_position_buffer)}set(){throw"not used"}render(){throw"not used!"}setAndRender(t,e){let r=this.gl;r.clearColor(0,0,0,0),r.clear(r.COLOR_BUFFER_BIT),r.useProgram(this.program),r.enableVertexAttribArray(this.a_position),r.uniform2f(this.u_resolution,r.canvas.width,r.canvas.height),r.bindBuffer(r.ARRAY_BUFFER,this.a_position_buffer);var i=r.FLOAT,s=0;r.vertexAttribPointer(this.a_position,2,i,!1,0,s);for(let e of t){this.setRectangle(r,e),r.uniform4f(this.u_color,Math.random(),Math.random(),Math.random(),1);var o=r.TRIANGLES;s=0;r.drawArrays(o,s,6)}}setRectangle(t,e){let r=e.getVertices();t.bufferData(t.ARRAY_BUFFER,new Float32Array([r[0].x,r[0].y,r[1].x,r[1].y,r[2].x,r[2].y,r[2].x,r[2].y,r[1].x,r[1].y,r[3].x,r[3].y]),t.STATIC_DRAW)}randomInt(t){return Math.floor(Math.random()*t)}}e.RectangleShader=RectangleShader},9381:(t,e,r)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.ShadedMeshShader=void 0;const i=r(4735);class ShadedMeshShader extends i.Shader{constructor(t){super(t,"\n\n        attribute vec4 a_vertex_position;\n        attribute vec3 a_vertex_normal;\n        attribute float a_vertex_ambi;\n    \n        uniform mat4 u_normal_matrix;\n        uniform mat4 u_personal_matrix;\n        uniform mat4 u_model_view_matrix;\n        uniform mat4 u_projection_matrix;\n\n        // should be uniforms constances\n        uniform vec3 u_ambient_light;\n        uniform vec3 u_dir_light_color;\n        uniform vec3 u_dir_light_vector;  \n\n        // varying vec2 v_texture_coord;\n        varying vec3 v_lighting;\n    \n        void main(void) {\n\n            gl_Position = u_projection_matrix * u_model_view_matrix * u_personal_matrix * a_vertex_position;\n            // v_texture_coord = a_texture_coord;\n        \n            // Apply lighting effect\n            // highpr is removed\n            vec4 transformedNormal = u_normal_matrix * vec4(a_vertex_normal, 1.0);\n            float directional = max(dot(transformedNormal.xyz, u_dir_light_vector), 0.0);\n            v_lighting = (u_ambient_light + (u_dir_light_color * directional));\n        }\n        ","\n        precision mediump float;\n\n        // Calculates the diffuse factor produced by the light illumination  \n        // if done like this, color could look nicer\n        // float diffuseFactor(vec3 normal, vec3 light_direction) {\n        //     float df = dot(normalize(normal), normalize(light_direction));\n        //     if (gl_FrontFacing) {\n        //         df = -df;\n        //     }\n        //     return max(0.0, df);\n        // }\n\n        varying vec3 v_lighting;\n\n        void main() {\n\n            // Fragment shader output\n            gl_FragColor = vec4(v_lighting, 1.0);\n        }\n        "),t.useProgram(this.program),this.count=0,this.size=0,this.u_normal_matrix=t.getUniformLocation(this.program,"u_normal_matrix"),this.u_model_view_matrix=t.getUniformLocation(this.program,"u_model_view_matrix"),this.u_projection_matrix=t.getUniformLocation(this.program,"u_projection_matrix"),this.u_personal_matrix=t.getUniformLocation(this.program,"u_personal_matrix"),this.u_ambient_light=t.getUniformLocation(this.program,"u_ambient_light"),this.u_dir_light_color=t.getUniformLocation(this.program,"u_dir_light_color"),this.u_dir_light_vector=t.getUniformLocation(this.program,"u_dir_light_vector"),this.a_vertex_position=t.getAttribLocation(this.program,"a_vertex_position"),this.a_vertex_postition_buffer=t.createBuffer(),this.a_vertex_normal=t.getAttribLocation(this.program,"a_vertex_normal"),this.a_vertex_normal_buffer=t.createBuffer(),this.a_vertex_ambi=t.getAttribLocation(this.program,"a_vertex_ambi"),this.a_vertex_ambi_buffer=t.createBuffer(),this.index_buffer=t.createBuffer()}set(t,e=i.DrawSpeed.StaticDraw){let r=this.gl;this.setShallow(r,t);let s=t.getNormalType();if(s==i.NormalKind.Face){r.useProgram(this.program),this.count=t.mesh.links.data.length;let s=this.convertDrawSpeed(e),o=i.MultiVector3.new(this.count),n=i.MultiVector3.new(this.count),a=new Float32Array(this.count);t.mesh.links.count();for(let e=0;e<t.mesh.links.count();e++){let r=t.norms.get(e);t.mesh.links.getRow(e).forEach(((i,s)=>{let h=3*e+s;o.set(h,t.mesh.verts.get(i)),n.set(h,r),a[h]=1}))}r.bindBuffer(r.ARRAY_BUFFER,this.a_vertex_postition_buffer),r.vertexAttribPointer(this.a_vertex_position,3,r.FLOAT,!1,0,0),r.bufferData(r.ARRAY_BUFFER,o.slice().data.buffer,s),r.bindBuffer(r.ARRAY_BUFFER,this.a_vertex_normal_buffer),r.vertexAttribPointer(this.a_vertex_normal,3,r.FLOAT,!1,0,0),r.bufferData(r.ARRAY_BUFFER,n.slice().data.buffer,s),r.bindBuffer(r.ELEMENT_ARRAY_BUFFER,this.index_buffer),r.bufferData(r.ELEMENT_ARRAY_BUFFER,i.getDefaultIndices(this.count),this.convertDrawSpeed(e))}else if(s==i.NormalKind.Vertex){r.useProgram(this.program);let i=this.convertDrawSpeed(e);t.ambi,t.mesh.links.count();this.count=t.mesh.links.data.length,r.bindBuffer(r.ARRAY_BUFFER,this.a_vertex_postition_buffer),r.vertexAttribPointer(this.a_vertex_position,3,r.FLOAT,!1,0,0),r.bufferData(r.ARRAY_BUFFER,t.mesh.verts.slice().data,i),r.bindBuffer(r.ARRAY_BUFFER,this.a_vertex_normal_buffer),r.vertexAttribPointer(this.a_vertex_normal,3,r.FLOAT,!1,0,0),r.bufferData(r.ARRAY_BUFFER,t.norms.slice().data,i),r.bindBuffer(r.ELEMENT_ARRAY_BUFFER,this.index_buffer),r.bufferData(r.ELEMENT_ARRAY_BUFFER,t.mesh.links.data,i)}else console.log("cannot render with this normal data");this.count>i.Const.MAX_U16&&(this.count=i.Const.MAX_U16,console.warn("mesh max reached."))}setShallow(t,e){t.useProgram(this.program),t.uniformMatrix4fv(this.u_personal_matrix,!1,e.position.data);let r=e.color,i=r.map((t=>.25*t));i[2]=Math.min(1,1.05*i[2]);let s=r.map((t=>t));s[0]=Math.min(1,1.05*s[0]),s[1]=Math.min(1,1.05*s[1]),s[2]=Math.min(1,1*s[2]),t.uniform3fv(this.u_ambient_light,i.slice(0,3)),t.uniform3fv(this.u_dir_light_color,s.slice(0,3))}render(t){let e=this.gl,r=t.camera;e.useProgram(this.program),e.uniformMatrix4fv(this.u_normal_matrix,!1,i.Matrix4.newIdentity().data),e.uniformMatrix4fv(this.u_model_view_matrix,!1,r.worldMatrix.data),e.uniformMatrix4fv(this.u_projection_matrix,!1,r.projectMatrix.data);r.getMouseWorldRay(e.canvas.width,e.canvas.height,!1).normal;e.uniform3fv(this.u_dir_light_vector,i.Vector3.unitX().add(i.Vector3.unitY()).add(i.Vector3.unitZ()).normalize().toArray()),e.enableVertexAttribArray(this.a_vertex_position),e.bindBuffer(e.ARRAY_BUFFER,this.a_vertex_postition_buffer),e.vertexAttribPointer(this.a_vertex_position,3,e.FLOAT,!1,0,0),e.enableVertexAttribArray(this.a_vertex_normal),e.bindBuffer(e.ARRAY_BUFFER,this.a_vertex_normal_buffer),e.vertexAttribPointer(this.a_vertex_normal,3,e.FLOAT,!1,0,0),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,this.index_buffer),e.drawElements(e.TRIANGLES,this.count,e.UNSIGNED_SHORT,0)}}e.ShadedMeshShader=ShadedMeshShader},5557:(t,e,r)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.SimpleMeshShader=void 0;const i=r(4735);class SimpleMeshShader extends i.Shader{constructor(t,e=[1,0,0,.25]){super(t,"\n        precision mediump int;\n        precision mediump float;\n\n        attribute vec4 a_position;\n        uniform mat4 u_transform;\n        uniform vec4 u_color;\n\n        void main() {\n            gl_Position = u_transform * a_position;\n        }\n        ","\n        precision mediump int;\n        precision mediump float;\n\n        uniform vec4 u_color;\n\n        void main () {\n            gl_FragColor = u_color;\n        }\n        "),this.u_transform=t.getUniformLocation(this.program,"u_transform"),this.u_color=t.getUniformLocation(this.program,"u_color"),t.useProgram(this.program),t.uniform4f(this.u_color,e[0],e[1],e[2],e[3]),this.count=0,this.size=0,this.a_position=t.getAttribLocation(this.program,"a_position"),this.a_position_buffer=t.createBuffer(),this.index_buffer=t.createBuffer()}set(t,e=i.DrawSpeed.StaticDraw){let r=this.gl;r.useProgram(this.program),this.count=t.links.data.length,r.bindBuffer(r.ARRAY_BUFFER,this.a_position_buffer),this.size=3;r.FLOAT;r.vertexAttribPointer(this.a_position,this.size,r.FLOAT,!1,0,0),r.bufferData(r.ARRAY_BUFFER,t.verts.slice().data,this.convertDrawSpeed(e)),r.bindBuffer(r.ELEMENT_ARRAY_BUFFER,this.index_buffer),r.bufferData(r.ELEMENT_ARRAY_BUFFER,t.links.data,this.convertDrawSpeed(e))}render(t){let e=this.gl,r=t.camera.totalMatrix;e.useProgram(this.program),e.enableVertexAttribArray(this.a_position),e.bindBuffer(e.ARRAY_BUFFER,this.a_position_buffer),e.vertexAttribPointer(this.a_position,this.size,e.FLOAT,!1,0,0),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,this.index_buffer),e.uniformMatrix4fv(this.u_transform,!1,r.data),e.drawElements(e.TRIANGLES,this.count,e.UNSIGNED_SHORT,0)}setAndRender(t,e){this.set(t,i.DrawSpeed.DynamicDraw),this.render(e)}}e.SimpleMeshShader=SimpleMeshShader},7854:(t,e,r)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.TextureMeshShader=void 0;const i=r(8390);class TextureMeshShader extends i.Shader{constructor(t){super(t,"\n        // precision mediump int;\n        // precision mediump float;\n\n        attribute vec4 a_position;\n        attribute vec2 a_texcoord;\n\n        uniform mat4 u_transform;\n\n        varying vec2 v_texcoord;\n\n        void main() {\n            gl_Position = u_transform * a_position;\n            v_texcoord = a_texcoord;\n        }\n        ","\n        precision mediump float;\n\n        varying vec2 v_texcoord;\n\n        uniform sampler2D u_texture;\n\n        void main() {\n            gl_FragColor = texture2D(u_texture, v_texcoord);\n        }\n        "),t.useProgram(this.program),this.count=0,this.size=0,this.u_transform=t.getUniformLocation(this.program,"u_transform"),this.u_texture=t.getUniformLocation(this.program,"u_texture"),this.a_position=t.getAttribLocation(this.program,"a_position"),this.a_position_buffer=t.createBuffer(),this.a_texcoord=t.getAttribLocation(this.program,"a_texcoord"),this.a_texcoord_buffer=t.createBuffer(),this.index_buffer=t.createBuffer(),this.texture_id=i.Shader.getNextTextureID(),this.texture=t.createTexture()}static new(t){return new TextureMeshShader(t)}set(t,e){let r=this.gl;t.texture?(r.useProgram(this.program),this.count=t.mesh.links.data.length,r.bindBuffer(r.ARRAY_BUFFER,this.a_position_buffer),r.vertexAttribPointer(this.a_position,3,r.FLOAT,!1,0,0),r.bufferData(r.ARRAY_BUFFER,t.mesh.verts.slice().data,this.convertDrawSpeed(e)),r.bindBuffer(r.ARRAY_BUFFER,this.a_texcoord_buffer),r.vertexAttribPointer(this.a_texcoord,2,r.FLOAT,!1,0,0),r.bufferData(r.ARRAY_BUFFER,t.uvs.toMatrixSlice().data,this.convertDrawSpeed(e)),r.bindBuffer(r.ELEMENT_ARRAY_BUFFER,this.index_buffer),r.bufferData(r.ELEMENT_ARRAY_BUFFER,new Uint16Array(t.mesh.links.data),this.convertDrawSpeed(e)),r.activeTexture(r.TEXTURE0+this.texture_id),r.bindTexture(r.TEXTURE_2D,this.texture),r.texImage2D(r.TEXTURE_2D,0,r.RGBA,r.RGBA,r.UNSIGNED_BYTE,t.texture),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MIN_FILTER,r.NEAREST),r.generateMipmap(r.TEXTURE_2D)):console.warn("Mesh does not contain a texture!")}render(t){let e=this.gl,r=t.camera.totalMatrix;e.useProgram(this.program),e.uniformMatrix4fv(this.u_transform,!1,r.data),e.uniform1i(this.u_texture,this.texture_id),e.activeTexture(e.TEXTURE0+this.texture_id),e.bindTexture(e.TEXTURE_2D,this.texture),e.enableVertexAttribArray(this.a_position),e.bindBuffer(e.ARRAY_BUFFER,this.a_position_buffer),e.vertexAttribPointer(this.a_position,3,e.FLOAT,!1,0,0),e.enableVertexAttribArray(this.a_texcoord),e.bindBuffer(e.ARRAY_BUFFER,this.a_texcoord_buffer),e.vertexAttribPointer(this.a_texcoord,2,e.FLOAT,!1,0,0),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,this.index_buffer),e.drawElements(e.TRIANGLES,this.count,e.UNSIGNED_SHORT,0)}setAndRender(t,e){this.set(t,i.DrawSpeed.DynamicDraw),this.render(e)}}e.TextureMeshShader=TextureMeshShader},3538:(t,e,r)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.Core=void 0;const i=r(2808),s=r(5282),o=r(5620);e.Core=class Core{constructor(t,e,r){this.fullscreen=!0,this.fpsInTitle=!0,this.canvas=t,this.gl=e,this.state=new i.InputState(t),this.fpsCounter=new s.FpsCounter,this.ui=new o.UI(r),this.apps=new Map}addApp(t){this.apps.set(t.name,t),this.activateApp(t)}removeApp(t){this.ui.removeContext(t),this.apps.delete(t)}activateApp(t){this.ui.addContext(t.name),this.ui.addText(t.description),t.ui(this.ui),t.start()}update(t){this.state.preUpdate(t),this.fpsCounter.update(this.state),this.apps.forEach((t=>{t.update(this.state)})),this.state.postUpdate()}draw(){const t=this.canvas,e=this.gl;this.fpsInTitle&&(document.title="fps: "+this.fpsCounter.getFps()),this.fullscreen&&(window.innerHeight==t.height&&window.innerWidth==t.width||(t.height=window.innerHeight,t.style.height=window.innerHeight.toString(),t.width=window.innerWidth,t.style.width=window.innerWidth.toString(),e.viewport(0,0,window.innerWidth,window.innerHeight))),this.gl.clearColor(0,0,0,0),this.gl.clear(this.gl.COLOR_BUFFER_BIT|this.gl.DEPTH_BUFFER_BIT),this.apps.forEach((t=>{t.draw(this.gl)}))}}},2474:(t,e)=>{function loadImageFromFile(t){return new Promise(((e,r)=>{let i=new FileReader;i.readAsDataURL(t),i.onload=()=>loadImageHelper1(i).then((t=>e(t)),(t=>r(t)))}))}function loadImageHelper1(t){return new Promise((function(e,r){let i=document.createElement("img");i.src=t.result,i.onload=()=>e(function loadImageHelper2(t){var e;let r=document.createElement("canvas");r.width=t.width,r.height=t.height;let i=r.getContext("2d");i.drawImage(t,0,0);let s=i.getImageData(0,0,t.width,t.height);return null===(e=r.parentNode)||void 0===e||e.removeChild(r),s}(i)),i.onerror=()=>r(new Error(`Script load error for ${i}`))}))}Object.defineProperty(e,"__esModule",{value:!0}),e.loadImageFromBlob=e.loadImageFromFile=e.loadJSONFromFile=e.loadTextFromFile=e.addDropFileEventListeners=void 0,e.addDropFileEventListeners=function addDropFileEventListeners(t,e){console.log("setting up drag events..."),t.addEventListener("dragenter",(function(t){return t.preventDefault(),console.log("entering entering..."),!0}),!0),t.addEventListener("dragover",(function(t){return t.preventDefault(),console.log("over drag...."),!0}),!0),t.addEventListener("dragleave",(function(t){return t.preventDefault(),console.log("leaving drag...."),!0}),!0),t.addEventListener("drop",(function(t){t.stopPropagation(),t.preventDefault();var r=t.dataTransfer.files;return e(r),!0}),!0)},e.loadTextFromFile=function loadTextFromFile(t){return new Promise(((e,r)=>{let i=new FileReader;i.readAsText(t),i.onload=()=>{e(i.result)},i.onerror=t=>r(t)}))},e.loadJSONFromFile=function loadJSONFromFile(t){return new Promise(((e,r)=>{let i=new FileReader;i.readAsText(t),i.onload=()=>{e(JSON.parse(i.result))},i.onerror=t=>r(t)}))},e.loadImageFromFile=loadImageFromFile,e.loadImageFromBlob=function loadImageFromBlob(t){return new Promise(((e,r)=>{let i=new FileReader;i.readAsDataURL(t),i.onload=()=>loadImageHelper1(i).then((t=>e(t)),(t=>r(t)))}))}},5282:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.FpsCounter=void 0;class FpsCounter{constructor(){this.fps=0,this.updateEveryXTicks=100,this.elapsed=0,this.frames=0}static new(){return new FpsCounter}_update(t){this.frames+=1,this.elapsed+=t,this.elapsed>this.updateEveryXTicks&&(this.setFps(),this.elapsed=0,this.frames=0)}update(t){this._update(t.tick)}setFps(){this.fps=Math.round(this.frames/this.elapsed*1e3)}getFps(){return this.fps}}e.FpsCounter=FpsCounter},2808:(t,e,r)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.InputState=void 0;const i=r(4013);var s;!function(t){t[t.A=0]="A",t[t.B=1]="B",t[t.C=2]="C",t[t.D=3]="D",t[t.E=4]="E",t[t.F=5]="F",t[t.G=6]="G",t[t.H=7]="H",t[t.I=8]="I",t[t.J=9]="J",t[t.K=10]="K",t[t.L=11]="L",t[t.M=12]="M",t[t.N=13]="N",t[t.O=14]="O",t[t.P=15]="P",t[t.Q=16]="Q",t[t.R=17]="R",t[t.S=18]="S",t[t.T=19]="T",t[t.U=20]="U",t[t.V=21]="V",t[t.W=22]="W",t[t.X=23]="X",t[t.Y=24]="Y",t[t.Z=25]="Z",t[t.Up=26]="Up",t[t.Down=27]="Down",t[t.Left=28]="Left",t[t.Right=29]="Right",t[t.Space=30]="Space",t[t.Control=31]="Control",t[t.Alt=32]="Alt",t[t.Shift=33]="Shift",t[t.Enter=34]="Enter",t[t.Esc=35]="Esc",t[t.N1=36]="N1",t[t.N2=37]="N2",t[t.N3=38]="N3",t[t.N4=39]="N4",t[t.N5=40]="N5",t[t.N6=41]="N6",t[t.N7=42]="N7",t[t.N8=43]="N8",t[t.N9=44]="N9",t[t.N0=45]="N0",t[t.Plus=46]="Plus",t[t.Minus=47]="Minus",t[t.Backspace=48]="Backspace"}(s||(s={}));class InputState{constructor(t){this.mousePos=i.Vector2.zero(),this.mousePosBuffered=i.Vector2.zero(),this.mousePosPrev=i.Vector2.zero(),this.mouseDelta=i.Vector2.zero(),this.mouseLeftDown=!1,this.mouseLeftPressed=!1,this.mouseLeftPrev=!1,this.mouseRightDown=!1,this.mouseRightPressed=!1,this.mouseRightPrev=!1,this.mouseMiddleDown=!1,this.mouseMiddlePressed=!1,this.mouseMiddlePrev=!1,this.keysDown={},this.keysPressed=[],this.scrollValue=0,this.scrollValuePrevious=0,this.mouseScrollDelta=0,this.mouseScrollBuffered=0,this.canvas=t,this.tick=0,this.oldTime=Date.now(),this.newTime=this.oldTime,this.startTime=Date.now(),this.minimumTick=1e3/144,t.addEventListener("mousedown",this.setMouseDown.bind(this)),t.addEventListener("mouseup",this.setMouseUp.bind(this)),t.addEventListener("contextmenu",(t=>{t.preventDefault(),t.stopPropagation()})),document.addEventListener("mousemove",this.onMouseMove.bind(this)),t.addEventListener("wheel",this.setMouseScroll.bind(this)),document.addEventListener("touchmove",this.setTouch.bind(this)),t.addEventListener("touchstart",this.setTouch.bind(this)),t.addEventListener("touchend",this.setTouchUp.bind(this)),t.addEventListener("keydown",this.onKeyDown.bind(this)),t.addEventListener("keyup",this.onKeyUp.bind(this)),t.focus()}static new(t){return new InputState(t)}preUpdate(t){if(this.newTime=Date.now(),this.oldTime=this.newTime,this.tick=t,this.mousePosBuffered.equals(this.mousePos)?this.mouseDelta=i.Vector2.zero():(this.mousePos=this.mousePosBuffered.clone(),this.mouseDelta=this.mousePos.subbed(this.mousePosPrev),this.mousePosPrev=this.mousePos.clone()),this.mouseLeftPressed=this.mouseLeftPrev!=this.mouseLeftDown&&this.mouseLeftDown,this.mouseRightPressed=this.mouseRightPrev!=this.mouseRightDown&&this.mouseRightDown,this.mouseMiddlePressed=this.mouseMiddlePrev!=this.mouseMiddleDown&&this.mouseMiddleDown,0!=this.mouseScrollBuffered){let t=.1;this.mouseScrollBuffered<0&&(t=-.1),this.scrollValue=Math.max(0,this.scrollValue+t),this.mouseScrollDelta=t,this.mouseScrollBuffered=0}else this.mouseScrollDelta=0}setScrollValue(t){this.scrollValue=Math.max(0,t)}postUpdate(){this.mouseLeftPrev=this.mouseLeftDown,this.mouseRightPrev=this.mouseRightDown,this.mouseMiddlePrev=this.mouseMiddleDown,this.keysPressed=[]}IsKeyDown(t){return this.keysDown[t]}IsKeyPressed(t){for(let e of this.keysPressed)if(e===t)return!0;return!1}onKeyDown(t){let e=t.key.toLowerCase();1!=this.keysDown[e]&&(this.keysDown[e]=!0,this.keysPressed.push(e))}onKeyUp(t){let e=t.key.toLowerCase();this.keysDown[e]=!1}onKeyPressed(t){}setTouch(t){t.preventDefault(),this.mousePos=new i.Vector2(t.touches[0].clientX,t.touches[0].clientY),this.mouseLeftDown=!0}setTouchUp(t){t.preventDefault(),this.mouseLeftDown=!1}setMouseScroll(t){this.mouseScrollBuffered=t.deltaY}onMouseMove(t){this.setMousePos(t.clientX,t.clientY)}setMousePos(t,e){this.mousePosBuffered=new i.Vector2(t,e)}setMouseUp(t){let e=t.buttons;e<4&&(this.mouseMiddleDown=!1),e<2&&(this.mouseRightDown=!1),e<1&&(this.mouseLeftDown=!1,this.onMouseLeftUp&&this.onMouseLeftUp())}setMouseDown(t){t.preventDefault(),t.stopPropagation(),this.canvas.focus();let e=t.buttons;return e>=4&&(e-=4,this.mouseMiddleDown=!0),e>=2&&(e-=2,this.mouseRightDown=!0),e>=1&&(e-=1,this.mouseLeftDown=!0),!1}}e.InputState=InputState},8663:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.Stopwatch=void 0;class Stopwatch{constructor(t,e){this.oldTime=t,this.newTime=e}static new(){let t=new Stopwatch(0,0);return t.time(),t}time(){this.newTime=this.getTime();let t=this.newTime-this.oldTime;return this.oldTime=this.newTime,t}log(t){console.log(`${t} took: ${this.time()} ms`)}getTime(){return(new Date).getTime()}}e.Stopwatch=Stopwatch},5620:(t,e,r)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.EnumParameter=e.Parameter=e.UI=void 0;const i=r(232),s=r(4540);class UI{constructor(t){this.globalContext=t,this.currentContext=t}static new(t){return new UI(t)}toggleVisibility(){this.globalContext.hidden?this.show():this.hide()}clear(){let t=this.currentContext;for(;t.hasChildNodes();)t.removeChild(t.lastChild)}hide(){this.globalContext.hidden=!0}show(){this.globalContext.hidden=!1}addContext(t){this.currentContext=this.globalContext;let e=this.addDiv(t+" app-interface");this.currentContext=e}setContext(t){this.globalContext.getElementsByClassName(t)}removeContext(t){this.setContext(t);for(let t=this.currentContext.childElementCount-1;t>=0;t-=1)this.currentContext.removeChild(this.currentContext.children.item(t));let e=this.currentContext;this.currentContext=this.globalContext,this.currentContext.removeChild(e)}addElement(t,e=""){let r=document.createElement(t);return r.className=e,this.currentContext.appendChild(r),r}addDiv(t,e=[]){let r=this.addElement("div",t);return e.forEach((t=>{r.appendChild(t)})),r}addBooleanParameter(t,e=(()=>{})){let r=this.addElement("input","checkbox");r.type="checkbox",r.addEventListener("change",(()=>{let i=r.checked;t.set(i?1:0),e(r.valueAsNumber),o.innerText=t.name})),r.checked=1==t.get();let i=this.addElement("label","check-container"),s=this.addElement("span","checkmark");i.appendChild(r),i.appendChild(s);let o=this.addElement("p","control-text");return o.innerText=t.name,this.addDiv("control",[o,i]),r}addParameter(t,e=(()=>{})){let r;r=t instanceof EnumParameter?t.p:t;let i=this.addRangeInput(r,e),s=this.addElement("p","control-text");s.innerText=r.name;let o=this.addElement("p","control-value");return o.innerText=t instanceof EnumParameter?t.getName():i.value,this.addDiv("control",[s,i,o]),t.setSliderAndText(i,o),i.oninput=()=>{r.set(i.valueAsNumber,!1),e(i.valueAsNumber),o.innerText=t instanceof EnumParameter?t.getName():i.value},i}addRangeInput(t,e=(()=>{})){let r=this.addElement("input","control-slider");return r.type="range",r.min=t.min.toString(),r.max=t.max.toString(),r.valueAsNumber=t.state,r.step=t.step.toString(),r}addText(t){this.addElement("p","ui-text").innerText=t}addButton(t,e){let r=this.addElement("button","control-button");r.innerText=t,r.addEventListener("click",e);let i=this.addElement("p","control-text");return this.addDiv("control",[i,r])}addDropdown(t,e){let r=t.values.length,i=this.addElement("select","enum-selector dropdown-select");for(let e=0;e<r;e++){let r=this.addElement("option","enum-item");r.innerText=t.values[e],i.appendChild(r)}return i.addEventListener("change",(r=>{let i=r.target.selectedIndex;t.set(i),e(i)})),this.addDiv("dropdown-dark",[i]),i}}e.UI=UI;class Parameter{constructor(t,e,r=-1/0,i=1/0,s=.1){this.name=t,this.min=r,this.max=i,this.step=s,this.state=e,this.set(this.state)}static new(t,e,r=-1/0,i=1/0,s=.1){return new Parameter(t,e,r,i,s)}static newBoolean(t,e){return new Parameter(t,e?1:0,0,1,1)}get(){return this.state}getDomain(){return i.Domain.new(this.min,this.max)}set(t,e=!0){s.GeonMath.clamp(t,this.min,this.max);let r=t-this.min,i=Math.round(r/this.step),o=this.min+this.step*i;this.state=s.GeonMath.clamp(o,this.min,this.max),e&&this.onset()}getNPermutations(){return Math.min((this.max-this.min)/this.step+1)}setSlider(t){this.slider=t}setSliderAndText(t,e){this.slider=t,this.text=e}onset(){this.slider&&(this.slider.valueAsNumber=this.state),this.text&&(this.text.innerText=this.state.toString())}}e.Parameter=Parameter;class EnumParameter{constructor(t,e){this.p=t,this.values=e}static new(t,e,r){return new EnumParameter(new Parameter(t,e,0,r.length-1,1),r)}getName(){return this.values[this.get()]}get(){return this.p.get()}set(t){return this.p.set(t)}getNPermutations(){return this.p.getNPermutations()}setSlider(t){this.slider=t}setSliderAndText(t,e){this.slider=t,this.text=e}onset(){this.slider&&(this.slider.valueAsNumber=this.get()),this.text&&(this.text.innerText=this.getName())}}e.EnumParameter=EnumParameter}},e={};function __webpack_require__(r){var i=e[r];if(void 0!==i)return i.exports;var s=e[r]={exports:{}};return t[r].call(s.exports,s,s.exports,__webpack_require__),s.exports}(()=>{var t=__webpack_require__(4735),e=__webpack_require__(7921);class CtxCamera{html_canvas;pos;scale;scaleRange=t.Domain.new(.3,5);onMouseDown;onMouseUp;onMouseMove;mousePos=t.Vector2.new();constructor(t,e,r){this.html_canvas=t,this.pos=e,this.scale=r}static new(t,e,r){return new CtxCamera(t,e,r)}log(){console.log(`camera pos: ${this.pos} scale: ${this.scale}`)}update(t){let e=!1,r=this.screenToWorld(t.mousePos);return this.mousePos=r,t.mouseLeftPressed&&this.onMouseDown&&this.onMouseDown(r),!t.mouseLeftDown&&t.mouseLeftPrev&&this.onMouseUp&&this.onMouseUp(r),t.mouseRightDown&&(this.pos.sub(t.mouseDelta),e=!0),0!=t.mouseScrollDelta&&(this.scale=this.scaleRange.comform(this.scale*(1-t.mouseScrollDelta)),e=!0),e}screenToWorld(t){return(t=t.clone()).add(this.pos),t.scaled(1/this.scale)}worldToScreen(t){return(t=t.clone()).scale(this.scale),t.sub(this.pos)}getCenter(){return this.getBox().elevate(t.Vector2.new(.5,.5))}moveCtxToState(t){t.translate(-this.pos.x,-this.pos.y),t.scale(this.scale,this.scale)}getBox(){let e=this.html_canvas.width,r=this.html_canvas.height;return t.Domain2.fromWH(this.pos.x,this.pos.y,e,r)}}function drawCircle(e,r,i,s="Luuk Withagen",o=50){e.fillStyle="#160f1d",e.strokeStyle="white",e.lineWidth=3,e.beginPath(),e.arc(r,i,o,0,2*Math.PI),e.fill(),preDrawText(e,"white",50),function fillMultilineText(t,e,r){let i=r.split("\n");0==i.length&&i.push(r);const s=20,o=-s*(i.length-1)/2;for(var n=0;n<i.length;n++)t.fillText(i[n],e.x,e.y+o+n*s)}(e,t.Vector2.new(r,i),s)}function preDrawText(t,e,r){t.fillStyle=e,t.lineWidth=.5,t.font=`${Math.floor(.4*r)}px Candara`,t.textAlign="center",t.textBaseline="middle"}function strokeMultilineText(t,e,r){let i=r.split("\n");0==i.length&&i.push(r);const s=-20*(i.length-1)/2;for(var o=0;o<i.length;o++)t.strokeText(i[o],e.x,e.y+s+20*o)}let r=5e3;window.setExpandAggression=t=>r=t;class Groover{pos;name;fellowNames;fellowCombo;constructor(t,e,r,i){this.pos=t,this.name=e,this.fellowNames=r,this.fellowCombo=i}static new(t,e){return new Groover(t,e,[],[])}}var i;!function(t){t[t.VeCo=0]="VeCo",t[t.Combo=1]="Combo",t[t.Bootleg=2]="Bootleg"}(i||(i={}));class Combo{name;type;members;color;pos;vector;constructor(t,e,r,i,s,o){this.name=t,this.type=e,this.members=r,this.color=i,this.pos=s,this.vector=o}static new(e,r,i,s){return new Combo(e,r,i,s,t.Vector2.zero(),t.Vector2.zero())}}class ComboomApp{canvas;ctx;camera;input;redrawAll=!0;groovers=new Map;combos=new Map;selected=void 0;collapseToCombo=!0;stopMoving=!1;constructor(t,e,r,i){this.canvas=t,this.ctx=e,this.camera=r,this.input=i}static new(e,r){const i=e.getContext("2d");if(!i)return void alert("Canvas Rendering not supported in your browser. Try upgrading or switching!");const s=CtxCamera.new(i.canvas,t.Vector2.new(-100,-100),1),o=t.InputState.new(i.canvas);let n=new ComboomApp(e,i,s,o);return n.onCreate(),n}onCreate(){window.addEventListener("resize",(()=>this.onResize())),this.onResize(),this.camera.onMouseDown=t=>{this.onMouseDown(t)},this.camera.onMouseUp=t=>{this.onMouseUp(t)},this.camera.pos=t.Vector2.new(-.5*this.canvas.width,-.5*this.canvas.height),this.camera.scale=.4}load(r){let s=t.Domain2.fromRadii(this.canvas.width,this.canvas.height),o=e.Random.fromRandom(),enlistCombo=(e,r)=>{this.combos.set(e.name,Combo.new(e.name,r,e.members,e.color));for(let r of e.members){let i=s.elevate(t.Vector2.fromRandom(o)),n=this.groovers.get(r);n||(n=Groover.new(i,r),this.groovers.set(r,n));for(let t of e.members)r!=t&&(n.fellowNames.push(t),n.fellowCombo.push(e.name))}};for(let t of r.vecos)enlistCombo(t,i.VeCo);for(let t of r.combos)enlistCombo(t,i.Combo)}ticks=0;update(t){this.input.preUpdate(t),this.camera.update(this.input)&&(this.redrawAll=!0),this.updateControls(),this.onMouseMove(this.camera.mousePos),this.stopMoving||(this.updateGroovers(),this.updateGrooversAndCombos(),this.redrawAll=!0),this.input.postUpdate(),this.ticks+=1,this.ticks>100&&(this.ticks=-1e8,r=1e3,this.collapseToCombo=!1),this.redrawAll=!0}updateControls(){this.input.IsKeyPressed("enter")&&(this.collapseToCombo=!this.collapseToCombo,console.log("collapse",this.collapseToCombo)),this.input.IsKeyPressed(" ")&&(this.stopMoving=!this.stopMoving,console.log("stop",this.stopMoving)),this.input.IsKeyPressed("p")&&(console.log("logging"),this.log()),this.input.IsKeyPressed("s")&&(console.log("making screenshot..."),this.makeScreenshot(5e3,2500)),this.input.IsKeyPressed("h")&&this.toggleHelpPanel()}toggleHelpPanel(){let t=document.getElementById("explanation");t.hidden=!t.hidden}log(){for(let t of this.groovers.values())console.log(t)}async makeScreenshot(e=1920,r=1080){try{t.Vector2.new(this.canvas.width,this.canvas.height),t.Vector2.new(e,r);let i=new OffscreenCanvas(e,r).getContext("2d");this.redrawAll=!0,this.draw(i);let s=await i.canvas.convertToBlob();!async function download(t){const e=document.createElement("a");e.href=t,e.download="",document.body.appendChild(e),e.click(),document.body.removeChild(e)}(URL.createObjectURL(s))}catch{return void alert("screenshot uses experimental features. Your browser does not seem to support it, sorry! try using chrome")}}updateGroovers(){this.foreachGroover(((t,e,r)=>{r&&function lerpEdge(t,e,r=.5,i=100){t.disTo(e);let s=e.subbed(t),o=t.added(s.scaled(.5)),n=o.added(s.normalized().scale(-.5*i)),a=o.added(s.normalized().scale(.5*i));t.copy(t.scaled(1-r).add(n.scaled(r))),e.copy(e.scaled(1-r).add(a.scaled(r)))}(t.pos,e.pos,.02,400)}))}updateGrooversAndCombos(e=.1){const i=t.Domain.new(500,600);for(let e of this.combos.values()){let r=t.Vector2.new();for(let t of e.members)r.add(this.groovers.get(t).pos);let i=r.scale(1/e.members.length);e.pos.copy(i)}if(this.collapseToCombo){for(let e of this.combos.values()){let s=t.Vector2.new(0,0),o=1/0;for(let t of this.combos.values()){if(e.name==t.name)continue;e.members.length;let i=t.pos.subbed(e.pos),n=i.length();n<o&&(o=n),s.add(i.normalize().scale(-1*r*(1/n)))}if(o>i.t0){let t=Math.max(0,1-i.normalize(o));s.scale(t)}e.pos.add(s)}for(let t of this.combos.values())for(let r of t.members){let i=this.groovers.get(r).pos;i.copy(i.scaled(1-e).add(t.pos.scaled(e)))}}}rescale(e,r){let i=r.x/e.x,s=r.y/e.y,o=t.Vector2.new(i,s);for(let t of this.groovers.values())t.pos.mul(o);for(let t of this.combos.values())t.pos.mul(o)}draw(e=this.ctx){if(!this.redrawAll)return;let r=this.camera;e.save(),e.clearRect(0,0,e.canvas.width,e.canvas.height),r.moveCtxToState(e),this.foreachGroover(((t,r,i)=>{!function drawLink(t,e,r,i,s){t.lineWidth=3,t.strokeStyle=s,t.beginPath(),t.moveTo(e.x,e.y),t.lineTo(r.x,r.y),t.stroke()}(e,t.pos,r.pos,i.name,i.color)}));for(let t of this.groovers.values())drawCircle(e,t.pos.x,t.pos.y,t.name.replace(" ","\n"));let i=t.Domain.new(4,15);for(let t of this.combos.values()){let r=t.members.length;r=i.comform(r),preDrawText(e,t.color,Math.min(25*r)),e.strokeStyle="white",e.lineWidth=.5*r,strokeMultilineText(e,t.pos,t.name)}e.restore()}onResize(){!function resizeCanvas(t){let e=t.canvas;const r=e.clientWidth,i=e.clientHeight,s=t.canvas.width!==r||t.canvas.height!==i;return s&&(t.canvas.width=r,t.canvas.height=i),s}(this.ctx),this.redrawAll=!0}onMouseUp(t){this.selected=void 0}onMouseMove(t){this.selected&&(this.groovers.get(this.selected).pos=t,this.redrawAll=!0)}onMouseDown(t){for(let e of this.groovers.values())if(t.disTo(e.pos)<80)return void(this.selected=e.name)}foreachGroover(t){let e=this.groovers;for(let r of e.values())for(let i=0;i<r.fellowNames.length;i++){let s=r.fellowNames[i],o=r.fellowCombo[i],n=e.get(s);r.name==n.name||r.name>n.name||t(r,n,this.combos.get(o))}}}window.addEventListener("load",(async function main(){const e=document.getElementById("nodes-canvas"),r=document.getElementById("nodes-panel"),i=ComboomApp.new(e,r);let s=await fetch("./resources/combos.json"),o=await s.json();i.load(o);let n=0,a=t.FpsCounter.new();requestAnimationFrame((function loop(t){let e=t-n;n=t,a._update(e),i.update(e),i.draw(),requestAnimationFrame(loop)}))}),!1)})()})();